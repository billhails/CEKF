let
  fn ls(dir) {
    let
        fn helper {
            (some(name), dh) {
                puts(name);
                putc('\n');
                helper(readdir(dh), dh);
            }
            (nothing, dh) {
                closedir(dh);
                'x'
            }
        }
    in
        switch(opendir(dir)) {
            (success(dh)) {
                helper(readdir(dh), dh)
            }
            (failure(errmsg)) {
                puts(errmsg);
                'x';
            }
        }
  }
in
    ls(switch (args(0)) {
        (some(name)) { name }
        (nothing) { "." }
    })
