// A way of quickly testing various rewrite stages
let
    link "samples.fn" as Samples;
    link "expr.fn" as E;
    link "../listutils.fn" as list;
    link "desugar.fn" as DS;
    link "closure-convert.fn" as CC; // SUT
in
    list.for_each(fn (str) {
        let
            expr = E.parse(str);
            dexpr = DS.desugar(expr);
        in
            E.print_expr(expr);
            puts(" ==>\nflat:    ");
            E.print_expr(CC.flat_closure_convert(dexpr)); // SUT
            puts("\nshared:  ");
            E.print_expr(CC.shared_closure_convert(dexpr)); // SUT
            puts("\n\n")
    }, Samples.data);