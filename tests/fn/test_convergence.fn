// Test to observe how many passes are needed for type convergence

{
// Simple case - should converge quickly
let f = fn(x) { x + 1 };
    g = fn(y) { f(y) * 2 };
in
    assert(typeof f == "number -> number");
    assert(typeof g == "number -> number");
};

{
// Mutual recursion - more passes needed
let isEven = fn(n) { if (n == 0) { true } else { isOdd(n - 1) } };
    isOdd = fn(n) { if (n == 0) { false } else { isEven(n - 1) } };
in
    assert(typeof isEven == "number -> bool");
    assert(typeof isOdd == "number -> bool");
};

{
// Complex case from test_tc.fn
let makeAdder = fn (x) {
        fn (y) { x + useMultiplier(y) }
    };
    useMultiplier = fn (n) {
        multiplier() * n
    };
    multiplier = fn () { 10 };
in
    assert(typeof makeAdder == "number -> number -> number");
};

{
// Three-way mutual recursion
let a = fn (n) { if (n == 0) { 0 } else { b(n - 1) + 1 } };
    b = fn (n) { if (n == 0) { 1 } else { c(n - 1) + 2 } };
    c = fn (n) { if (n == 0) { 2 } else { a(n - 1) + 3 } };
in
    assert(typeof a == "number -> number");
    assert(typeof b == "number -> number");
    assert(typeof c == "number -> number");
};
