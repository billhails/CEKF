let
    fn test_curry(n, f) {
        f(n)
    }

    fn add(a, b) {
        a + b
    }

    fn makeWriter() {
        switch(openmem()) {
            (success(fh)) {
                success(#(fputs(fh), fn() { fgets(fh) }));
            }
            (failure(err)) { failure(err) }
        }
    }

in
    assert(test_curry(2, add(3)) == 5);
    unsafe switch(makeWriter()) {
        (success(#(fp, fg))) {
            puts("Testing curried fput:\n");
            fp("Hello, ");
            fp("world!\n");
            puts(typeof fp);
            puts("\n");
            puts(typeof fg);
            puts("\n");
            puts(fg());
            puts("Testing curried fput done\n");
            assert(true)
        }
    }