//
// Test hygienic operator definitions
//

let
    // Test 1: Simple Prefix operator with bare symbol
    fn double(x) { x * 2 }
    operator "~_" 10 double;
    
    // Test 2: Prefix operator with inline function
    operator "!_" 10 fn(x) { x + 1 };
    
    // Test 3: Prefix operator with complex expression
    fn add_three(x) { x + 3 }
    operator "%_" 10 fn(y) { add_three(y * 2) };
    
    // Test 4: Operator with captured variable (hygiene test)
    fn make_adder(n) {
        fn(x) { x + n }
    }
    operator "incr_" 10 make_adder(100);
    
    // Test 5: Word operators
    fn negate(x) { 0 - x }
    operator "neg_" 10 negate;
in
    assert(~5 == 10);
    assert(~10 == 20);
    
    assert(!5 == 6);
    assert(!10 == 11);
    
    assert(%5 == 13);  // (5 * 2) + 3 = 13
    assert(%10 == 23); // (10 * 2) + 3 = 23
    
    assert(incr 5 == 105);
    assert(incr 20 == 120);
    
    assert(neg 5 == -5);
    assert(neg -10 == 10);
    
    // Test 6: Operator hygiene - scoped redefinition
    {
        let
            fn triple(x) { x * 3 }
            operator "triple_" 10 triple;
        in
            assert(triple 5 == 15);
            assert(triple 10 == 30);
            
            // Nested scope with different definition
            {
                let
                    fn quadruple(x) { x * 4 }
                    operator "quad_" 10 quadruple;
                in
                    assert(quad 5 == 20);
                    assert(quad 10 == 40)
            };
            
            // triple should still work here
            assert(triple 5 == 15);
            assert(triple 10 == 30)
    };
    




