/*
 * CEKF - VM supporting amb
 * Copyright (C) 2022-2023  Bill Hails
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <https://www.gnu.org/licenses/>.
 */
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>

#include "common.h"
#include "ast.h"
#include "debug_ast.h"
#include "parser.h"
#include "analysis.h"
#include "exp.h"
#include "memory.h"
#include "step.h"
#include "debug.h"
#include "bytecode.h"
#include "desugaring.h"

#ifdef DEBUG_RUN_TESTS
#if DEBUG_RUN_TESTS == 1

/**
 * these test examples were generated by giving ../tools/makeTree.py each of
 * the scheme files in ../scm then pasting the output here and formatting
 * with `indent --linux`
 */

Exp *makeTestExpAmb()
{
	/* back.scm */
	return
	    newExp(EXP_TYPE_LET,
		   EXP_VAL_LET(newExpLet
			       (newAexpVar("x"),
				newExp(EXP_TYPE_CEXP,
				       EXP_VAL_CEXP(newCexp
						    (CEXP_TYPE_AMB,
						     CEXP_VAL_AMB(newCexpAmb
								  (newExp
								   (EXP_TYPE_AEXP,
								    EXP_VAL_AEXP
								    (newAexp
								     (AEXP_TYPE_FALSE,
								      AEXP_VAL_FALSE
								      ()))),
								   newExp
								   (EXP_TYPE_AEXP,
								    EXP_VAL_AEXP
								    (newAexp
								     (AEXP_TYPE_TRUE,
								      AEXP_VAL_TRUE
								      ())))))))),
				newExp(EXP_TYPE_CEXP,
				       EXP_VAL_CEXP(newCexp
						    (CEXP_TYPE_COND,
						     CEXP_VAL_COND(newCexpCond
								   (newAexp
								    (AEXP_TYPE_VAR,
								     AEXP_VAL_VAR
								     (newAexpVar
								      ("x"))),
								    newExp
								    (EXP_TYPE_AEXP,
								     EXP_VAL_AEXP
								     (newAexp
								      (AEXP_TYPE_INT,
								       AEXP_VAL_INT
								       (5)))),
								    newExp
								    (EXP_TYPE_CEXP,
								     EXP_VAL_CEXP
								     (newCexp
								      (CEXP_TYPE_BACK,
								       CEXP_VAL_BACK
								       ())))))))))));
}

Exp *makeTestExpCallCC()
{
	/* callcc.scm */
	return
	    newExp(EXP_TYPE_LET,
		   EXP_VAL_LET(newExpLet
			       (newAexpVar("a"),
				newExp(EXP_TYPE_CEXP,
				       EXP_VAL_CEXP(newCexp
						    (CEXP_TYPE_CALLCC,
						     CEXP_VAL_CALLCC(newAexp
								     (AEXP_TYPE_LAM,
								      AEXP_VAL_LAM
								      (newAexpLam
								       (newAexpVarList
									(NULL,
									 newAexpVar
									 ("ret")),
									newExp
									(EXP_TYPE_LET,
									 EXP_VAL_LET
									 (newExpLet
									  (newAexpVar
									   ("b"),
									   newExp
									   (EXP_TYPE_CEXP,
									    EXP_VAL_CEXP
									    (newCexp
									     (CEXP_TYPE_APPLY,
									      CEXP_VAL_APPLY
									      (newCexpApply
									       (newAexp
										(AEXP_TYPE_VAR,
										 AEXP_VAL_VAR
										 (newAexpVar
										  ("ret"))),
										newAexpList
										(NULL,
										 newAexp
										 (AEXP_TYPE_INT,
										  AEXP_VAL_INT
										  (5)))))))),
									   newExp
									   (EXP_TYPE_CEXP,
									    EXP_VAL_CEXP
									    (newCexp
									     (CEXP_TYPE_COND,
									      CEXP_VAL_COND
									      (newCexpCond
									       (newAexp
										(AEXP_TYPE_VAR,
										 AEXP_VAL_VAR
										 (newAexpVar
										  ("b"))),
										newExp
										(EXP_TYPE_AEXP,
										 EXP_VAL_AEXP
										 (newAexp
										  (AEXP_TYPE_INT,
										   AEXP_VAL_INT
										   (6)))),
										newExp
										(EXP_TYPE_AEXP,
										 EXP_VAL_AEXP
										 (newAexp
										  (AEXP_TYPE_INT,
										   AEXP_VAL_INT
										   (7))))))))))))))))))),
				newExp(EXP_TYPE_AEXP,
				       EXP_VAL_AEXP(newAexp
						    (AEXP_TYPE_VAR,
						     AEXP_VAL_VAR(newAexpVar
								  ("a"))))))));
}

Exp *makeTestExpCallCC2()
{
	/* callcc2.scm */
	return
	    newExp(EXP_TYPE_LET,
		   EXP_VAL_LET(newExpLet
			       (newAexpVar("x"),
				newExp(EXP_TYPE_CEXP,
				       EXP_VAL_CEXP(newCexp
						    (CEXP_TYPE_CALLCC,
						     CEXP_VAL_CALLCC(newAexp
								     (AEXP_TYPE_LAM,
								      AEXP_VAL_LAM
								      (newAexpLam
								       (newAexpVarList
									(NULL,
									 newAexpVar
									 ("ret")),
									newExp
									(EXP_TYPE_LET,
									 EXP_VAL_LET
									 (newExpLet
									  (newAexpVar
									   ("y"),
									   newExp
									   (EXP_TYPE_CEXP,
									    EXP_VAL_CEXP
									    (newCexp
									     (CEXP_TYPE_CALLCC,
									      CEXP_VAL_CALLCC
									      (newAexp
									       (AEXP_TYPE_VAR,
										AEXP_VAL_VAR
										(newAexpVar
										 ("ret"))))))),
									   newExp
									   (EXP_TYPE_CEXP,
									    EXP_VAL_CEXP
									    (newCexp
									     (CEXP_TYPE_COND,
									      CEXP_VAL_COND
									      (newCexpCond
									       (newAexp
										(AEXP_TYPE_VAR,
										 AEXP_VAL_VAR
										 (newAexpVar
										  ("y"))),
										newExp
										(EXP_TYPE_AEXP,
										 EXP_VAL_AEXP
										 (newAexp
										  (AEXP_TYPE_LAM,
										   AEXP_VAL_LAM
										   (newAexpLam
										    (newAexpVarList
										     (NULL,
										      newAexpVar
										      ("x")),
										     newExp
										     (EXP_TYPE_AEXP,
										      EXP_VAL_AEXP
										      (newAexp
										       (AEXP_TYPE_INT,
											AEXP_VAL_INT
											(6))))))))),
										newExp
										(EXP_TYPE_AEXP,
										 EXP_VAL_AEXP
										 (newAexp
										  (AEXP_TYPE_LAM,
										   AEXP_VAL_LAM
										   (newAexpLam
										    (newAexpVarList
										     (NULL,
										      newAexpVar
										      ("x")),
										     newExp
										     (EXP_TYPE_AEXP,
										      EXP_VAL_AEXP
										      (newAexp
										       (AEXP_TYPE_INT,
											AEXP_VAL_INT
											(7)))))))))))))))))))))))),
				newExp(EXP_TYPE_CEXP,
				       EXP_VAL_CEXP(newCexp
						    (CEXP_TYPE_APPLY,
						     CEXP_VAL_APPLY(newCexpApply
								    (newAexp
								     (AEXP_TYPE_VAR,
								      AEXP_VAL_VAR
								      (newAexpVar
								       ("x"))),
								     newAexpList
								     (NULL,
								      newAexp
								      (AEXP_TYPE_TRUE,
								       AEXP_VAL_TRUE
								       ()))))))))));
}


Exp *makeTestExpFib(int depth)
{
	/* fib.scm */
	return
	    newExp(EXP_TYPE_CEXP,
		   EXP_VAL_CEXP(newCexp
				(CEXP_TYPE_LETREC,
				 CEXP_VAL_LETREC(newCexpLetRec
						 (newLetRecBindings
						  (NULL, newAexpVar("fib"),
						   newAexp(AEXP_TYPE_LAM,
							   AEXP_VAL_LAM
							   (newAexpLam
							    (newAexpVarList
							     (NULL,
							      newAexpVar("n")),
							     newExp
							     (EXP_TYPE_CEXP,
							      EXP_VAL_CEXP
							      (newCexp
							       (CEXP_TYPE_COND,
								CEXP_VAL_COND
								(newCexpCond
								 (newAexp
								  (AEXP_TYPE_PRIM,
								   AEXP_VAL_PRIM
								   (newAexpPrimApp
								    (AEXP_PRIM_LT,
								     newAexp
								     (AEXP_TYPE_VAR,
								      AEXP_VAL_VAR
								      (newAexpVar
								       ("n"))),
								     newAexp
								     (AEXP_TYPE_INT,
								      AEXP_VAL_INT
								      (2))))),
								  newExp
								  (EXP_TYPE_AEXP,
								   EXP_VAL_AEXP
								   (newAexp
								    (AEXP_TYPE_INT,
								     AEXP_VAL_INT
								     (1)))),
								  newExp
								  (EXP_TYPE_LET,
								   EXP_VAL_LET
								   (newExpLet
								    (newAexpVar
								     ("fib1"),
								     newExp
								     (EXP_TYPE_CEXP,
								      EXP_VAL_CEXP
								      (newCexp
								       (CEXP_TYPE_APPLY,
									CEXP_VAL_APPLY
									(newCexpApply
									 (newAexp
									  (AEXP_TYPE_VAR,
									   AEXP_VAL_VAR
									   (newAexpVar
									    ("fib"))),
									  newAexpList
									  (NULL,
									   newAexp
									   (AEXP_TYPE_PRIM,
									    AEXP_VAL_PRIM
									    (newAexpPrimApp
									     (AEXP_PRIM_SUB,
									      newAexp
									      (AEXP_TYPE_VAR,
									       AEXP_VAL_VAR
									       (newAexpVar
										("n"))),
									      newAexp
									      (AEXP_TYPE_INT,
									       AEXP_VAL_INT
									       (1))))))))))),
								     newExp
								     (EXP_TYPE_LET,
								      EXP_VAL_LET
								      (newExpLet
								       (newAexpVar
									("fib2"),
									newExp
									(EXP_TYPE_CEXP,
									 EXP_VAL_CEXP
									 (newCexp
									  (CEXP_TYPE_APPLY,
									   CEXP_VAL_APPLY
									   (newCexpApply
									    (newAexp
									     (AEXP_TYPE_VAR,
									      AEXP_VAL_VAR
									      (newAexpVar
									       ("fib"))),
									     newAexpList
									     (NULL,
									      newAexp
									      (AEXP_TYPE_PRIM,
									       AEXP_VAL_PRIM
									       (newAexpPrimApp
										(AEXP_PRIM_SUB,
										 newAexp
										 (AEXP_TYPE_VAR,
										  AEXP_VAL_VAR
										  (newAexpVar
										   ("n"))),
										 newAexp
										 (AEXP_TYPE_INT,
										  AEXP_VAL_INT
										  (2))))))))))),
									newExp
									(EXP_TYPE_AEXP,
									 EXP_VAL_AEXP
									 (newAexp
									  (AEXP_TYPE_PRIM,
									   AEXP_VAL_PRIM
									   (newAexpPrimApp
									    (AEXP_PRIM_ADD,
									     newAexp
									     (AEXP_TYPE_VAR,
									      AEXP_VAL_VAR
									      (newAexpVar
									       ("fib1"))),
									     newAexp
									     (AEXP_TYPE_VAR,
									      AEXP_VAL_VAR
									      (newAexpVar
									       ("fib2"))))))))))))))))))))))),
						  newExp(EXP_TYPE_CEXP,
							 EXP_VAL_CEXP(newCexp
								      (CEXP_TYPE_APPLY,
								       CEXP_VAL_APPLY
								       (newCexpApply
									(newAexp
									 (AEXP_TYPE_VAR,
									  AEXP_VAL_VAR
									  (newAexpVar
									   ("fib"))),
									 newAexpList
									 (NULL,
									  newAexp
									  (AEXP_TYPE_INT,
									   AEXP_VAL_INT
									   (depth)))))))))))));
}

Exp *makeTestExpXor()
{
	/* xor.scm */
	return newExp(EXP_TYPE_AEXP,
		      EXP_VAL_AEXP(newAexp
				   (AEXP_TYPE_PRIM,
				    AEXP_VAL_PRIM(newAexpPrimApp
						  (AEXP_PRIM_XOR,
						   newAexp(AEXP_TYPE_TRUE,
							   AEXP_VAL_TRUE()),
						   newAexp(AEXP_TYPE_FALSE,
							   AEXP_VAL_FALSE
							   ()))))));
}

Exp *
makeTestExpOneOf() {
  /* one-of.scm */
  return
    newExp(EXP_TYPE_CEXP,
           EXP_VAL_CEXP(newCexp
                        (CEXP_TYPE_LETREC,
                         CEXP_VAL_LETREC(newCexpLetRec
                                         (newLetRecBindings
                                          (newLetRecBindings
                                           (NULL, newAexpVar("one-of"),
                                            newAexp(AEXP_TYPE_LAM,
                                                    AEXP_VAL_LAM(newAexpLam
                                                                 (newAexpVarList
                                                                  (NULL,
                                                                   newAexpVar
                                                                   ("lst")),
                                                                  newExp
                                                                  (EXP_TYPE_LET,
                                                                   EXP_VAL_LET
                                                                   (newExpLet
                                                                    (newAexpVar
                                                                     ("f"),
                                                                     newExp
                                                                     (EXP_TYPE_CEXP,
                                                                      EXP_VAL_CEXP
                                                                      (newCexp
                                                                       (CEXP_TYPE_APPLY,
                                                                        CEXP_VAL_APPLY
                                                                        (newCexpApply
                                                                         (newAexp
                                                                          (AEXP_TYPE_VAR,
                                                                           AEXP_VAL_VAR
                                                                           (newAexpVar
                                                                            ("require"))),
                                                                          newAexpList
                                                                          (NULL,
                                                                           newAexp
                                                                           (AEXP_TYPE_VAR,
                                                                            AEXP_VAL_VAR
                                                                            (newAexpVar
                                                                             ("lst"))))))))),
                                                                     newExp
                                                                     (EXP_TYPE_CEXP,
                                                                      EXP_VAL_CEXP
                                                                      (newCexp
                                                                       (CEXP_TYPE_AMB,
                                                                        CEXP_VAL_AMB
                                                                        (newCexpAmb
                                                                         (newExp
                                                                          (EXP_TYPE_AEXP,
                                                                           EXP_VAL_AEXP
                                                                           (newAexp
                                                                            (AEXP_TYPE_UNARY,
                                                                             AEXP_VAL_UNARY
                                                                             (newAexpUnaryApp
                                                                              (AEXP_UNARY_CAR,
                                                                               newAexp
                                                                               (AEXP_TYPE_VAR,
                                                                                AEXP_VAL_VAR
                                                                                (newAexpVar
                                                                                 ("lst")))))))),
                                                                          newExp
                                                                          (EXP_TYPE_CEXP,
                                                                           EXP_VAL_CEXP
                                                                           (newCexp
                                                                            (CEXP_TYPE_APPLY,
                                                                             CEXP_VAL_APPLY
                                                                             (newCexpApply
                                                                              (newAexp
                                                                               (AEXP_TYPE_VAR,
                                                                                AEXP_VAL_VAR
                                                                                (newAexpVar
                                                                                 ("one-of"))),
                                                                               newAexpList
                                                                               (NULL,
                                                                                newAexp
                                                                                (AEXP_TYPE_UNARY,
                                                                                 AEXP_VAL_UNARY
                                                                                 (newAexpUnaryApp
                                                                                  (AEXP_UNARY_CDR,
                                                                                   newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("lst")))))))))))))))))))))))),
                                           newAexpVar("require"),
                                           newAexp(AEXP_TYPE_LAM,
                                                   AEXP_VAL_LAM(newAexpLam
                                                                (newAexpVarList
                                                                 (NULL,
                                                                  newAexpVar
                                                                  ("condition")),
                                                                 newExp
                                                                 (EXP_TYPE_CEXP,
                                                                  EXP_VAL_CEXP
                                                                  (newCexp
                                                                   (CEXP_TYPE_BOOL,
                                                                    CEXP_VAL_BOOL
                                                                    (newCexpBool
                                                                     (BOOL_TYPE_OR,
                                                                      newExp
                                                                      (EXP_TYPE_AEXP,
                                                                       EXP_VAL_AEXP
                                                                       (newAexp
                                                                        (AEXP_TYPE_VAR,
                                                                         AEXP_VAL_VAR
                                                                         (newAexpVar
                                                                          ("condition"))))),
                                                                      newExp
                                                                      (EXP_TYPE_CEXP,
                                                                       EXP_VAL_CEXP
                                                                       (newCexp
                                                                        (CEXP_TYPE_BACK,
                                                                         CEXP_VAL_BACK
                                                                         ())))))))))))),
                                          newExp(EXP_TYPE_LET,
                                                 EXP_VAL_LET(newExpLet
                                                             (newAexpVar("a"),
                                                              newExp
                                                              (EXP_TYPE_CEXP,
                                                               EXP_VAL_CEXP
                                                               (newCexp
                                                                (CEXP_TYPE_APPLY,
                                                                 CEXP_VAL_APPLY
                                                                 (newCexpApply
                                                                  (newAexp
                                                                   (AEXP_TYPE_VAR,
                                                                    AEXP_VAL_VAR
                                                                    (newAexpVar
                                                                     ("one-of"))),
                                                                   newAexpList
                                                                   (NULL,
                                                                    newAexp
                                                                    (AEXP_TYPE_LIST,
                                                                     AEXP_VAL_LIST
                                                                     (newAexpList
                                                                      (newAexpList
                                                                       (newAexpList
                                                                        (newAexpList
                                                                         (newAexpList
                                                                          (NULL,
                                                                           newAexp
                                                                           (AEXP_TYPE_INT,
                                                                            AEXP_VAL_INT
                                                                            (5))),
                                                                          newAexp
                                                                          (AEXP_TYPE_INT,
                                                                           AEXP_VAL_INT
                                                                           (4))),
                                                                         newAexp
                                                                         (AEXP_TYPE_INT,
                                                                          AEXP_VAL_INT
                                                                          (3))),
                                                                        newAexp
                                                                        (AEXP_TYPE_INT,
                                                                         AEXP_VAL_INT
                                                                         (2))),
                                                                       newAexp
                                                                       (AEXP_TYPE_INT,
                                                                        AEXP_VAL_INT
                                                                        (1))))))))))),
                                                              newExp
                                                              (EXP_TYPE_LET,
                                                               EXP_VAL_LET
                                                               (newExpLet
                                                                (newAexpVar
                                                                 ("f"),
                                                                 newExp
                                                                 (EXP_TYPE_CEXP,
                                                                  EXP_VAL_CEXP
                                                                  (newCexp
                                                                   (CEXP_TYPE_APPLY,
                                                                    CEXP_VAL_APPLY
                                                                    (newCexpApply
                                                                     (newAexp
                                                                      (AEXP_TYPE_VAR,
                                                                       AEXP_VAL_VAR
                                                                       (newAexpVar
                                                                        ("require"))),
                                                                      newAexpList
                                                                      (NULL,
                                                                       newAexp
                                                                       (AEXP_TYPE_PRIM,
                                                                        AEXP_VAL_PRIM
                                                                        (newAexpPrimApp
                                                                         (AEXP_PRIM_EQ,
                                                                          newAexp
                                                                          (AEXP_TYPE_VAR,
                                                                           AEXP_VAL_VAR
                                                                           (newAexpVar
                                                                            ("a"))),
                                                                          newAexp
                                                                          (AEXP_TYPE_INT,
                                                                           AEXP_VAL_INT
                                                                           (3))))))))))),
                                                                 newExp
                                                                 (EXP_TYPE_AEXP,
                                                                  EXP_VAL_AEXP
                                                                  (newAexp
                                                                   (AEXP_TYPE_VAR,
                                                                    AEXP_VAL_VAR
                                                                    (newAexpVar
                                                                     ("a"))))))))))))))));
}

Exp *makeTestExpBool()
{
	/* bool.scm */
	return
	    newExp(EXP_TYPE_LET,
		   EXP_VAL_LET(newExpLet
			       (newAexpVar("r"),
				newExp(EXP_TYPE_CEXP,
				       EXP_VAL_CEXP(newCexp
						    (CEXP_TYPE_BOOL,
						     CEXP_VAL_BOOL(newCexpBool
								   (BOOL_TYPE_AND,
								    newExp
								    (EXP_TYPE_CEXP,
								     EXP_VAL_CEXP
								     (newCexp
								      (CEXP_TYPE_BOOL,
								       CEXP_VAL_BOOL
								       (newCexpBool
									(BOOL_TYPE_OR,
									 newExp
									 (EXP_TYPE_AEXP,
									  EXP_VAL_AEXP
									  (newAexp
									   (AEXP_TYPE_FALSE,
									    AEXP_VAL_FALSE
									    ()))),
									 newExp
									 (EXP_TYPE_AEXP,
									  EXP_VAL_AEXP
									  (newAexp
									   (AEXP_TYPE_TRUE,
									    AEXP_VAL_TRUE
									    ())))))))),
								    newExp
								    (EXP_TYPE_CEXP,
								     EXP_VAL_CEXP
								     (newCexp
								      (CEXP_TYPE_BOOL,
								       CEXP_VAL_BOOL
								       (newCexpBool
									(BOOL_TYPE_AND,
									 newExp
									 (EXP_TYPE_AEXP,
									  EXP_VAL_AEXP
									  (newAexp
									   (AEXP_TYPE_TRUE,
									    AEXP_VAL_TRUE
									    ()))),
									 newExp
									 (EXP_TYPE_AEXP,
									  EXP_VAL_AEXP
									  (newAexp
									   (AEXP_TYPE_TRUE,
									    AEXP_VAL_TRUE
									    ()))))))))))))),
				newExp(EXP_TYPE_AEXP,
				       EXP_VAL_AEXP(newAexp
						    (AEXP_TYPE_VAR,
						     AEXP_VAL_VAR(newAexpVar
								  ("r"))))))));
}

Exp *makeTestExpCons()
{
	/* cons.scm */
	return newExp(EXP_TYPE_LET,
		      EXP_VAL_LET(newExpLet
				  (newAexpVar("a"),
				   newExp(EXP_TYPE_AEXP,
					  EXP_VAL_AEXP(newAexp
						       (AEXP_TYPE_PRIM,
							AEXP_VAL_PRIM
							(newAexpPrimApp
							 (AEXP_PRIM_CONS,
							  newAexp(AEXP_TYPE_INT,
								  AEXP_VAL_INT
								  (1)),
							  newAexp
							  (AEXP_TYPE_PRIM,
							   AEXP_VAL_PRIM
							   (newAexpPrimApp
							    (AEXP_PRIM_CONS,
							     newAexp
							     (AEXP_TYPE_INT,
							      AEXP_VAL_INT(2)),
							     newAexp
							     (AEXP_TYPE_PRIM,
							      AEXP_VAL_PRIM
							      (newAexpPrimApp
							       (AEXP_PRIM_CONS,
								newAexp
								(AEXP_TYPE_INT,
								 AEXP_VAL_INT
								 (3)),
								newAexp
								(AEXP_TYPE_VOID,
								 AEXP_VAL_VOID
								 ())))))))))))),
				   newExp(EXP_TYPE_AEXP,
					  EXP_VAL_AEXP(newAexp
						       (AEXP_TYPE_UNARY,
							AEXP_VAL_UNARY
							(newAexpUnaryApp
							 (AEXP_UNARY_CAR,
							  newAexp
							  (AEXP_TYPE_UNARY,
							   AEXP_VAL_UNARY
							   (newAexpUnaryApp
							    (AEXP_UNARY_CDR,
							     newAexp
							     (AEXP_TYPE_VAR,
							      AEXP_VAL_VAR
							      (newAexpVar
							       ("a"))))))))))))));
}

Exp *makeTestExpNot()
{
	/* not.scm */
	return
	    newExp(EXP_TYPE_AEXP,
		   EXP_VAL_AEXP(newAexp
				(AEXP_TYPE_UNARY,
				 AEXP_VAL_UNARY(newAexpUnaryApp
						(AEXP_UNARY_NOT,
						 newAexp(AEXP_TYPE_FALSE,
							 AEXP_VAL_FALSE()))))));
}

Exp *
makeTestExpLiars() {
  /* liars.scm */
  return
    newExp(EXP_TYPE_LET,
           EXP_VAL_LET(newExpLet
                       (newAexpVar("one-to-five"),
                        newExp(EXP_TYPE_AEXP,
                               EXP_VAL_AEXP(newAexp
                                            (AEXP_TYPE_LIST,
                                             AEXP_VAL_LIST(newAexpList
                                                           (newAexpList
                                                            (newAexpList
                                                             (newAexpList
                                                              (newAexpList
                                                               (NULL,
                                                                newAexp
                                                                (AEXP_TYPE_INT,
                                                                 AEXP_VAL_INT
                                                                 (5))),
                                                               newAexp
                                                               (AEXP_TYPE_INT,
                                                                AEXP_VAL_INT
                                                                (4))),
                                                              newAexp
                                                              (AEXP_TYPE_INT,
                                                               AEXP_VAL_INT
                                                               (3))),
                                                             newAexp
                                                             (AEXP_TYPE_INT,
                                                              AEXP_VAL_INT
                                                              (2))),
                                                            newAexp
                                                            (AEXP_TYPE_INT,
                                                             AEXP_VAL_INT
                                                             (1))))))),
                        newExp(EXP_TYPE_CEXP,
                               EXP_VAL_CEXP(newCexp
                                            (CEXP_TYPE_LETREC,
                                             CEXP_VAL_LETREC(newCexpLetRec
                                                             (newLetRecBindings
                                                              (newLetRecBindings
                                                               (newLetRecBindings
                                                                (newLetRecBindings
                                                                 (newLetRecBindings
                                                                  (NULL,
                                                                   newAexpVar
                                                                   ("exclude"),
                                                                   newAexp
                                                                   (AEXP_TYPE_LAM,
                                                                    AEXP_VAL_LAM
                                                                    (newAexpLam
                                                                     (newAexpVarList
                                                                      (newAexpVarList
                                                                       (NULL,
                                                                        newAexpVar
                                                                        ("lst")),
                                                                       newAexpVar
                                                                       ("items")),
                                                                      newExp
                                                                      (EXP_TYPE_CEXP,
                                                                       EXP_VAL_CEXP
                                                                       (newCexp
                                                                        (CEXP_TYPE_COND,
                                                                         CEXP_VAL_COND
                                                                         (newCexpCond
                                                                          (newAexp
                                                                           (AEXP_TYPE_VAR,
                                                                            AEXP_VAL_VAR
                                                                            (newAexpVar
                                                                             ("lst"))),
                                                                           newExp
                                                                           (EXP_TYPE_LET,
                                                                            EXP_VAL_LET
                                                                            (newExpLet
                                                                             (newAexpVar
                                                                              ("mem"),
                                                                              newExp
                                                                              (EXP_TYPE_CEXP,
                                                                               EXP_VAL_CEXP
                                                                               (newCexp
                                                                                (CEXP_TYPE_APPLY,
                                                                                 CEXP_VAL_APPLY
                                                                                 (newCexpApply
                                                                                  (newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("member"))),
                                                                                   newAexpList
                                                                                   (newAexpList
                                                                                    (NULL,
                                                                                     newAexp
                                                                                     (AEXP_TYPE_VAR,
                                                                                      AEXP_VAL_VAR
                                                                                      (newAexpVar
                                                                                       ("items")))),
                                                                                    newAexp
                                                                                    (AEXP_TYPE_UNARY,
                                                                                     AEXP_VAL_UNARY
                                                                                     (newAexpUnaryApp
                                                                                      (AEXP_UNARY_CAR,
                                                                                       newAexp
                                                                                       (AEXP_TYPE_VAR,
                                                                                        AEXP_VAL_VAR
                                                                                        (newAexpVar
                                                                                         ("lst")))))))))))),
                                                                              newExp
                                                                              (EXP_TYPE_CEXP,
                                                                               EXP_VAL_CEXP
                                                                               (newCexp
                                                                                (CEXP_TYPE_COND,
                                                                                 CEXP_VAL_COND
                                                                                 (newCexpCond
                                                                                  (newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("mem"))),
                                                                                   newExp
                                                                                   (EXP_TYPE_CEXP,
                                                                                    EXP_VAL_CEXP
                                                                                    (newCexp
                                                                                     (CEXP_TYPE_APPLY,
                                                                                      CEXP_VAL_APPLY
                                                                                      (newCexpApply
                                                                                       (newAexp
                                                                                        (AEXP_TYPE_VAR,
                                                                                         AEXP_VAL_VAR
                                                                                         (newAexpVar
                                                                                          ("exclude"))),
                                                                                        newAexpList
                                                                                        (newAexpList
                                                                                         (NULL,
                                                                                          newAexp
                                                                                          (AEXP_TYPE_UNARY,
                                                                                           AEXP_VAL_UNARY
                                                                                           (newAexpUnaryApp
                                                                                            (AEXP_UNARY_CDR,
                                                                                             newAexp
                                                                                             (AEXP_TYPE_VAR,
                                                                                              AEXP_VAL_VAR
                                                                                              (newAexpVar
                                                                                               ("lst"))))))),
                                                                                         newAexp
                                                                                         (AEXP_TYPE_VAR,
                                                                                          AEXP_VAL_VAR
                                                                                          (newAexpVar
                                                                                           ("items"))))))))),
                                                                                   newExp
                                                                                   (EXP_TYPE_LET,
                                                                                    EXP_VAL_LET
                                                                                    (newExpLet
                                                                                     (newAexpVar
                                                                                      ("excluded"),
                                                                                      newExp
                                                                                      (EXP_TYPE_CEXP,
                                                                                       EXP_VAL_CEXP
                                                                                       (newCexp
                                                                                        (CEXP_TYPE_APPLY,
                                                                                         CEXP_VAL_APPLY
                                                                                         (newCexpApply
                                                                                          (newAexp
                                                                                           (AEXP_TYPE_VAR,
                                                                                            AEXP_VAL_VAR
                                                                                            (newAexpVar
                                                                                             ("exclude"))),
                                                                                           newAexpList
                                                                                           (newAexpList
                                                                                            (NULL,
                                                                                             newAexp
                                                                                             (AEXP_TYPE_UNARY,
                                                                                              AEXP_VAL_UNARY
                                                                                              (newAexpUnaryApp
                                                                                               (AEXP_UNARY_CDR,
                                                                                                newAexp
                                                                                                (AEXP_TYPE_VAR,
                                                                                                 AEXP_VAL_VAR
                                                                                                 (newAexpVar
                                                                                                  ("lst"))))))),
                                                                                            newAexp
                                                                                            (AEXP_TYPE_VAR,
                                                                                             AEXP_VAL_VAR
                                                                                             (newAexpVar
                                                                                              ("items"))))))))),
                                                                                      newExp
                                                                                      (EXP_TYPE_AEXP,
                                                                                       EXP_VAL_AEXP
                                                                                       (newAexp
                                                                                        (AEXP_TYPE_PRIM,
                                                                                         AEXP_VAL_PRIM
                                                                                         (newAexpPrimApp
                                                                                          (AEXP_PRIM_CONS,
                                                                                           newAexp
                                                                                           (AEXP_TYPE_UNARY,
                                                                                            AEXP_VAL_UNARY
                                                                                            (newAexpUnaryApp
                                                                                             (AEXP_UNARY_CAR,
                                                                                              newAexp
                                                                                              (AEXP_TYPE_VAR,
                                                                                               AEXP_VAL_VAR
                                                                                               (newAexpVar
                                                                                                ("lst")))))),
                                                                                           newAexp
                                                                                           (AEXP_TYPE_VAR,
                                                                                            AEXP_VAL_VAR
                                                                                            (newAexpVar
                                                                                             ("excluded"))))))))))))))))))),
                                                                           newExp
                                                                           (EXP_TYPE_AEXP,
                                                                            EXP_VAL_AEXP
                                                                            (newAexp
                                                                             (AEXP_TYPE_VOID,
                                                                              AEXP_VAL_VOID
                                                                              ())))))))))))),
                                                                  newAexpVar
                                                                  ("require"),
                                                                  newAexp
                                                                  (AEXP_TYPE_LAM,
                                                                   AEXP_VAL_LAM
                                                                   (newAexpLam
                                                                    (newAexpVarList
                                                                     (NULL,
                                                                      newAexpVar
                                                                      ("condition")),
                                                                     newExp
                                                                     (EXP_TYPE_CEXP,
                                                                      EXP_VAL_CEXP
                                                                      (newCexp
                                                                       (CEXP_TYPE_BOOL,
                                                                        CEXP_VAL_BOOL
                                                                        (newCexpBool
                                                                         (BOOL_TYPE_OR,
                                                                          newExp
                                                                          (EXP_TYPE_AEXP,
                                                                           EXP_VAL_AEXP
                                                                           (newAexp
                                                                            (AEXP_TYPE_VAR,
                                                                             AEXP_VAL_VAR
                                                                             (newAexpVar
                                                                              ("condition"))))),
                                                                          newExp
                                                                          (EXP_TYPE_CEXP,
                                                                           EXP_VAL_CEXP
                                                                           (newCexp
                                                                            (CEXP_TYPE_BACK,
                                                                             CEXP_VAL_BACK
                                                                             ())))))))))))),
                                                                 newAexpVar
                                                                 ("member"),
                                                                 newAexp
                                                                 (AEXP_TYPE_LAM,
                                                                  AEXP_VAL_LAM
                                                                  (newAexpLam
                                                                   (newAexpVarList
                                                                    (newAexpVarList
                                                                     (NULL,
                                                                      newAexpVar
                                                                      ("lst")),
                                                                     newAexpVar
                                                                     ("item")),
                                                                    newExp
                                                                    (EXP_TYPE_CEXP,
                                                                     EXP_VAL_CEXP
                                                                     (newCexp
                                                                      (CEXP_TYPE_COND,
                                                                       CEXP_VAL_COND
                                                                       (newCexpCond
                                                                        (newAexp
                                                                         (AEXP_TYPE_VAR,
                                                                          AEXP_VAL_VAR
                                                                          (newAexpVar
                                                                           ("lst"))),
                                                                         newExp
                                                                         (EXP_TYPE_CEXP,
                                                                          EXP_VAL_CEXP
                                                                          (newCexp
                                                                           (CEXP_TYPE_BOOL,
                                                                            CEXP_VAL_BOOL
                                                                            (newCexpBool
                                                                             (BOOL_TYPE_OR,
                                                                              newExp
                                                                              (EXP_TYPE_AEXP,
                                                                               EXP_VAL_AEXP
                                                                               (newAexp
                                                                                (AEXP_TYPE_PRIM,
                                                                                 AEXP_VAL_PRIM
                                                                                 (newAexpPrimApp
                                                                                  (AEXP_PRIM_EQ,
                                                                                   newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("item"))),
                                                                                   newAexp
                                                                                   (AEXP_TYPE_UNARY,
                                                                                    AEXP_VAL_UNARY
                                                                                    (newAexpUnaryApp
                                                                                     (AEXP_UNARY_CAR,
                                                                                      newAexp
                                                                                      (AEXP_TYPE_VAR,
                                                                                       AEXP_VAL_VAR
                                                                                       (newAexpVar
                                                                                        ("lst"))))))))))),
                                                                              newExp
                                                                              (EXP_TYPE_CEXP,
                                                                               EXP_VAL_CEXP
                                                                               (newCexp
                                                                                (CEXP_TYPE_APPLY,
                                                                                 CEXP_VAL_APPLY
                                                                                 (newCexpApply
                                                                                  (newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("member"))),
                                                                                   newAexpList
                                                                                   (newAexpList
                                                                                    (NULL,
                                                                                     newAexp
                                                                                     (AEXP_TYPE_UNARY,
                                                                                      AEXP_VAL_UNARY
                                                                                      (newAexpUnaryApp
                                                                                       (AEXP_UNARY_CDR,
                                                                                        newAexp
                                                                                        (AEXP_TYPE_VAR,
                                                                                         AEXP_VAL_VAR
                                                                                         (newAexpVar
                                                                                          ("lst"))))))),
                                                                                    newAexp
                                                                                    (AEXP_TYPE_VAR,
                                                                                     AEXP_VAL_VAR
                                                                                     (newAexpVar
                                                                                      ("item")))))))))))))),
                                                                         newExp
                                                                         (EXP_TYPE_AEXP,
                                                                          EXP_VAL_AEXP
                                                                          (newAexp
                                                                           (AEXP_TYPE_FALSE,
                                                                            AEXP_VAL_FALSE
                                                                            ())))))))))))),
                                                                newAexpVar
                                                                ("one-of"),
                                                                newAexp
                                                                (AEXP_TYPE_LAM,
                                                                 AEXP_VAL_LAM
                                                                 (newAexpLam
                                                                  (newAexpVarList
                                                                   (NULL,
                                                                    newAexpVar
                                                                    ("lst")),
                                                                   newExp
                                                                   (EXP_TYPE_LET,
                                                                    EXP_VAL_LET
                                                                    (newExpLet
                                                                     (newAexpVar
                                                                      ("f"),
                                                                      newExp
                                                                      (EXP_TYPE_CEXP,
                                                                       EXP_VAL_CEXP
                                                                       (newCexp
                                                                        (CEXP_TYPE_APPLY,
                                                                         CEXP_VAL_APPLY
                                                                         (newCexpApply
                                                                          (newAexp
                                                                           (AEXP_TYPE_VAR,
                                                                            AEXP_VAL_VAR
                                                                            (newAexpVar
                                                                             ("require"))),
                                                                           newAexpList
                                                                           (NULL,
                                                                            newAexp
                                                                            (AEXP_TYPE_VAR,
                                                                             AEXP_VAL_VAR
                                                                             (newAexpVar
                                                                              ("lst"))))))))),
                                                                      newExp
                                                                      (EXP_TYPE_CEXP,
                                                                       EXP_VAL_CEXP
                                                                       (newCexp
                                                                        (CEXP_TYPE_AMB,
                                                                         CEXP_VAL_AMB
                                                                         (newCexpAmb
                                                                          (newExp
                                                                           (EXP_TYPE_AEXP,
                                                                            EXP_VAL_AEXP
                                                                            (newAexp
                                                                             (AEXP_TYPE_UNARY,
                                                                              AEXP_VAL_UNARY
                                                                              (newAexpUnaryApp
                                                                               (AEXP_UNARY_CAR,
                                                                                newAexp
                                                                                (AEXP_TYPE_VAR,
                                                                                 AEXP_VAL_VAR
                                                                                 (newAexpVar
                                                                                  ("lst")))))))),
                                                                           newExp
                                                                           (EXP_TYPE_CEXP,
                                                                            EXP_VAL_CEXP
                                                                            (newCexp
                                                                             (CEXP_TYPE_APPLY,
                                                                              CEXP_VAL_APPLY
                                                                              (newCexpApply
                                                                               (newAexp
                                                                                (AEXP_TYPE_VAR,
                                                                                 AEXP_VAL_VAR
                                                                                 (newAexpVar
                                                                                  ("one-of"))),
                                                                                newAexpList
                                                                                (NULL,
                                                                                 newAexp
                                                                                 (AEXP_TYPE_UNARY,
                                                                                  AEXP_VAL_UNARY
                                                                                  (newAexpUnaryApp
                                                                                   (AEXP_UNARY_CDR,
                                                                                    newAexp
                                                                                    (AEXP_TYPE_VAR,
                                                                                     AEXP_VAL_VAR
                                                                                     (newAexpVar
                                                                                      ("lst")))))))))))))))))))))))),
                                                               newAexpVar
                                                               ("liars"),
                                                               newAexp
                                                               (AEXP_TYPE_LAM,
                                                                AEXP_VAL_LAM
                                                                (newAexpLam
                                                                 (newAexpVarList
                                                                  (NULL,
                                                                   newAexpVar
                                                                   ("x")),
                                                                  newExp
                                                                  (EXP_TYPE_LET,
                                                                   EXP_VAL_LET
                                                                   (newExpLet
                                                                    (newAexpVar
                                                                     ("betty"),
                                                                     newExp
                                                                     (EXP_TYPE_CEXP,
                                                                      EXP_VAL_CEXP
                                                                      (newCexp
                                                                       (CEXP_TYPE_AMB,
                                                                        CEXP_VAL_AMB
                                                                        (newCexpAmb
                                                                         (newExp
                                                                          (EXP_TYPE_AEXP,
                                                                           EXP_VAL_AEXP
                                                                           (newAexp
                                                                            (AEXP_TYPE_INT,
                                                                             AEXP_VAL_INT
                                                                             (1)))),
                                                                          newExp
                                                                          (EXP_TYPE_CEXP,
                                                                           EXP_VAL_CEXP
                                                                           (newCexp
                                                                            (CEXP_TYPE_AMB,
                                                                             CEXP_VAL_AMB
                                                                             (newCexpAmb
                                                                              (newExp
                                                                               (EXP_TYPE_AEXP,
                                                                                EXP_VAL_AEXP
                                                                                (newAexp
                                                                                 (AEXP_TYPE_INT,
                                                                                  AEXP_VAL_INT
                                                                                  (2)))),
                                                                               newExp
                                                                               (EXP_TYPE_CEXP,
                                                                                EXP_VAL_CEXP
                                                                                (newCexp
                                                                                 (CEXP_TYPE_AMB,
                                                                                  CEXP_VAL_AMB
                                                                                  (newCexpAmb
                                                                                   (newExp
                                                                                    (EXP_TYPE_AEXP,
                                                                                     EXP_VAL_AEXP
                                                                                     (newAexp
                                                                                      (AEXP_TYPE_INT,
                                                                                       AEXP_VAL_INT
                                                                                       (3)))),
                                                                                    newExp
                                                                                    (EXP_TYPE_CEXP,
                                                                                     EXP_VAL_CEXP
                                                                                     (newCexp
                                                                                      (CEXP_TYPE_AMB,
                                                                                       CEXP_VAL_AMB
                                                                                       (newCexpAmb
                                                                                        (newExp
                                                                                         (EXP_TYPE_AEXP,
                                                                                          EXP_VAL_AEXP
                                                                                          (newAexp
                                                                                           (AEXP_TYPE_INT,
                                                                                            AEXP_VAL_INT
                                                                                            (4)))),
                                                                                         newExp
                                                                                         (EXP_TYPE_AEXP,
                                                                                          EXP_VAL_AEXP
                                                                                          (newAexp
                                                                                           (AEXP_TYPE_INT,
                                                                                            AEXP_VAL_INT
                                                                                            (5)))))))))))))))))))))))),
                                                                     newExp
                                                                     (EXP_TYPE_LET,
                                                                      EXP_VAL_LET
                                                                      (newExpLet
                                                                       (newAexpVar
                                                                        ("not-betty"),
                                                                        newExp
                                                                        (EXP_TYPE_CEXP,
                                                                         EXP_VAL_CEXP
                                                                         (newCexp
                                                                          (CEXP_TYPE_APPLY,
                                                                           CEXP_VAL_APPLY
                                                                           (newCexpApply
                                                                            (newAexp
                                                                             (AEXP_TYPE_VAR,
                                                                              AEXP_VAL_VAR
                                                                              (newAexpVar
                                                                               ("exclude"))),
                                                                             newAexpList
                                                                             (newAexpList
                                                                              (NULL,
                                                                               newAexp
                                                                               (AEXP_TYPE_VAR,
                                                                                AEXP_VAL_VAR
                                                                                (newAexpVar
                                                                                 ("one-to-five")))),
                                                                              newAexp
                                                                              (AEXP_TYPE_LIST,
                                                                               AEXP_VAL_LIST
                                                                               (newAexpList
                                                                                (NULL,
                                                                                 newAexp
                                                                                 (AEXP_TYPE_VAR,
                                                                                  AEXP_VAL_VAR
                                                                                  (newAexpVar
                                                                                   ("betty")))))))))))),
                                                                        newExp
                                                                        (EXP_TYPE_LET,
                                                                         EXP_VAL_LET
                                                                         (newExpLet
                                                                          (newAexpVar
                                                                           ("ethel"),
                                                                           newExp
                                                                           (EXP_TYPE_CEXP,
                                                                            EXP_VAL_CEXP
                                                                            (newCexp
                                                                             (CEXP_TYPE_APPLY,
                                                                              CEXP_VAL_APPLY
                                                                              (newCexpApply
                                                                               (newAexp
                                                                                (AEXP_TYPE_VAR,
                                                                                 AEXP_VAL_VAR
                                                                                 (newAexpVar
                                                                                  ("one-of"))),
                                                                                newAexpList
                                                                                (NULL,
                                                                                 newAexp
                                                                                 (AEXP_TYPE_VAR,
                                                                                  AEXP_VAL_VAR
                                                                                  (newAexpVar
                                                                                   ("not-betty"))))))))),
                                                                           newExp
                                                                           (EXP_TYPE_LET,
                                                                            EXP_VAL_LET
                                                                            (newExpLet
                                                                             (newAexpVar
                                                                              ("not-betty-or-ethel"),
                                                                              newExp
                                                                              (EXP_TYPE_CEXP,
                                                                               EXP_VAL_CEXP
                                                                               (newCexp
                                                                                (CEXP_TYPE_APPLY,
                                                                                 CEXP_VAL_APPLY
                                                                                 (newCexpApply
                                                                                  (newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("exclude"))),
                                                                                   newAexpList
                                                                                   (newAexpList
                                                                                    (NULL,
                                                                                     newAexp
                                                                                     (AEXP_TYPE_VAR,
                                                                                      AEXP_VAL_VAR
                                                                                      (newAexpVar
                                                                                       ("one-to-five")))),
                                                                                    newAexp
                                                                                    (AEXP_TYPE_LIST,
                                                                                     AEXP_VAL_LIST
                                                                                     (newAexpList
                                                                                      (newAexpList
                                                                                       (NULL,
                                                                                        newAexp
                                                                                        (AEXP_TYPE_VAR,
                                                                                         AEXP_VAL_VAR
                                                                                         (newAexpVar
                                                                                          ("ethel")))),
                                                                                       newAexp
                                                                                       (AEXP_TYPE_VAR,
                                                                                        AEXP_VAL_VAR
                                                                                        (newAexpVar
                                                                                         ("betty")))))))))))),
                                                                              newExp
                                                                              (EXP_TYPE_LET,
                                                                               EXP_VAL_LET
                                                                               (newExpLet
                                                                                (newAexpVar
                                                                                 ("joan"),
                                                                                 newExp
                                                                                 (EXP_TYPE_CEXP,
                                                                                  EXP_VAL_CEXP
                                                                                  (newCexp
                                                                                   (CEXP_TYPE_APPLY,
                                                                                    CEXP_VAL_APPLY
                                                                                    (newCexpApply
                                                                                     (newAexp
                                                                                      (AEXP_TYPE_VAR,
                                                                                       AEXP_VAL_VAR
                                                                                       (newAexpVar
                                                                                        ("one-of"))),
                                                                                      newAexpList
                                                                                      (NULL,
                                                                                       newAexp
                                                                                       (AEXP_TYPE_VAR,
                                                                                        AEXP_VAL_VAR
                                                                                        (newAexpVar
                                                                                         ("not-betty-or-ethel"))))))))),
                                                                                 newExp
                                                                                 (EXP_TYPE_LET,
                                                                                  EXP_VAL_LET
                                                                                  (newExpLet
                                                                                   (newAexpVar
                                                                                    ("not-betty-or-ethel-or-joan"),
                                                                                    newExp
                                                                                    (EXP_TYPE_CEXP,
                                                                                     EXP_VAL_CEXP
                                                                                     (newCexp
                                                                                      (CEXP_TYPE_APPLY,
                                                                                       CEXP_VAL_APPLY
                                                                                       (newCexpApply
                                                                                        (newAexp
                                                                                         (AEXP_TYPE_VAR,
                                                                                          AEXP_VAL_VAR
                                                                                          (newAexpVar
                                                                                           ("exclude"))),
                                                                                         newAexpList
                                                                                         (newAexpList
                                                                                          (NULL,
                                                                                           newAexp
                                                                                           (AEXP_TYPE_VAR,
                                                                                            AEXP_VAL_VAR
                                                                                            (newAexpVar
                                                                                             ("one-to-five")))),
                                                                                          newAexp
                                                                                          (AEXP_TYPE_LIST,
                                                                                           AEXP_VAL_LIST
                                                                                           (newAexpList
                                                                                            (newAexpList
                                                                                             (newAexpList
                                                                                              (NULL,
                                                                                               newAexp
                                                                                               (AEXP_TYPE_VAR,
                                                                                                AEXP_VAL_VAR
                                                                                                (newAexpVar
                                                                                                 ("joan")))),
                                                                                              newAexp
                                                                                              (AEXP_TYPE_VAR,
                                                                                               AEXP_VAL_VAR
                                                                                               (newAexpVar
                                                                                                ("ethel")))),
                                                                                             newAexp
                                                                                             (AEXP_TYPE_VAR,
                                                                                              AEXP_VAL_VAR
                                                                                              (newAexpVar
                                                                                               ("betty")))))))))))),
                                                                                    newExp
                                                                                    (EXP_TYPE_LET,
                                                                                     EXP_VAL_LET
                                                                                     (newExpLet
                                                                                      (newAexpVar
                                                                                       ("kitty"),
                                                                                       newExp
                                                                                       (EXP_TYPE_CEXP,
                                                                                        EXP_VAL_CEXP
                                                                                        (newCexp
                                                                                         (CEXP_TYPE_APPLY,
                                                                                          CEXP_VAL_APPLY
                                                                                          (newCexpApply
                                                                                           (newAexp
                                                                                            (AEXP_TYPE_VAR,
                                                                                             AEXP_VAL_VAR
                                                                                             (newAexpVar
                                                                                              ("one-of"))),
                                                                                            newAexpList
                                                                                            (NULL,
                                                                                             newAexp
                                                                                             (AEXP_TYPE_VAR,
                                                                                              AEXP_VAL_VAR
                                                                                              (newAexpVar
                                                                                               ("not-betty-or-ethel-or-joan"))))))))),
                                                                                       newExp
                                                                                       (EXP_TYPE_LET,
                                                                                        EXP_VAL_LET
                                                                                        (newExpLet
                                                                                         (newAexpVar
                                                                                          ("not-betty-or-ethel-or-joan-or-kitty"),
                                                                                          newExp
                                                                                          (EXP_TYPE_CEXP,
                                                                                           EXP_VAL_CEXP
                                                                                           (newCexp
                                                                                            (CEXP_TYPE_APPLY,
                                                                                             CEXP_VAL_APPLY
                                                                                             (newCexpApply
                                                                                              (newAexp
                                                                                               (AEXP_TYPE_VAR,
                                                                                                AEXP_VAL_VAR
                                                                                                (newAexpVar
                                                                                                 ("exclude"))),
                                                                                               newAexpList
                                                                                               (newAexpList
                                                                                                (NULL,
                                                                                                 newAexp
                                                                                                 (AEXP_TYPE_VAR,
                                                                                                  AEXP_VAL_VAR
                                                                                                  (newAexpVar
                                                                                                   ("one-to-five")))),
                                                                                                newAexp
                                                                                                (AEXP_TYPE_LIST,
                                                                                                 AEXP_VAL_LIST
                                                                                                 (newAexpList
                                                                                                  (newAexpList
                                                                                                   (newAexpList
                                                                                                    (newAexpList
                                                                                                     (NULL,
                                                                                                      newAexp
                                                                                                      (AEXP_TYPE_VAR,
                                                                                                       AEXP_VAL_VAR
                                                                                                       (newAexpVar
                                                                                                        ("kitty")))),
                                                                                                     newAexp
                                                                                                     (AEXP_TYPE_VAR,
                                                                                                      AEXP_VAL_VAR
                                                                                                      (newAexpVar
                                                                                                       ("joan")))),
                                                                                                    newAexp
                                                                                                    (AEXP_TYPE_VAR,
                                                                                                     AEXP_VAL_VAR
                                                                                                     (newAexpVar
                                                                                                      ("ethel")))),
                                                                                                   newAexp
                                                                                                   (AEXP_TYPE_VAR,
                                                                                                    AEXP_VAL_VAR
                                                                                                    (newAexpVar
                                                                                                     ("betty")))))))))))),
                                                                                          newExp
                                                                                          (EXP_TYPE_LET,
                                                                                           EXP_VAL_LET
                                                                                           (newExpLet
                                                                                            (newAexpVar
                                                                                             ("mary"),
                                                                                             newExp
                                                                                             (EXP_TYPE_AEXP,
                                                                                              EXP_VAL_AEXP
                                                                                              (newAexp
                                                                                               (AEXP_TYPE_UNARY,
                                                                                                AEXP_VAL_UNARY
                                                                                                (newAexpUnaryApp
                                                                                                 (AEXP_UNARY_CAR,
                                                                                                  newAexp
                                                                                                  (AEXP_TYPE_VAR,
                                                                                                   AEXP_VAL_VAR
                                                                                                   (newAexpVar
                                                                                                    ("not-betty-or-ethel-or-joan-or-kitty")))))))),
                                                                                             newExp
                                                                                             (EXP_TYPE_LET,
                                                                                              EXP_VAL_LET
                                                                                              (newExpLet
                                                                                               (newAexpVar
                                                                                                ("f"),
                                                                                                newExp
                                                                                                (EXP_TYPE_CEXP,
                                                                                                 EXP_VAL_CEXP
                                                                                                 (newCexp
                                                                                                  (CEXP_TYPE_APPLY,
                                                                                                   CEXP_VAL_APPLY
                                                                                                   (newCexpApply
                                                                                                    (newAexp
                                                                                                     (AEXP_TYPE_VAR,
                                                                                                      AEXP_VAL_VAR
                                                                                                      (newAexpVar
                                                                                                       ("require"))),
                                                                                                     newAexpList
                                                                                                     (NULL,
                                                                                                      newAexp
                                                                                                      (AEXP_TYPE_PRIM,
                                                                                                       AEXP_VAL_PRIM
                                                                                                       (newAexpPrimApp
                                                                                                        (AEXP_PRIM_XOR,
                                                                                                         newAexp
                                                                                                         (AEXP_TYPE_PRIM,
                                                                                                          AEXP_VAL_PRIM
                                                                                                          (newAexpPrimApp
                                                                                                           (AEXP_PRIM_EQ,
                                                                                                            newAexp
                                                                                                            (AEXP_TYPE_VAR,
                                                                                                             AEXP_VAL_VAR
                                                                                                             (newAexpVar
                                                                                                              ("kitty"))),
                                                                                                            newAexp
                                                                                                            (AEXP_TYPE_INT,
                                                                                                             AEXP_VAL_INT
                                                                                                             (2))))),
                                                                                                         newAexp
                                                                                                         (AEXP_TYPE_PRIM,
                                                                                                          AEXP_VAL_PRIM
                                                                                                          (newAexpPrimApp
                                                                                                           (AEXP_PRIM_EQ,
                                                                                                            newAexp
                                                                                                            (AEXP_TYPE_VAR,
                                                                                                             AEXP_VAL_VAR
                                                                                                             (newAexpVar
                                                                                                              ("betty"))),
                                                                                                            newAexp
                                                                                                            (AEXP_TYPE_INT,
                                                                                                             AEXP_VAL_INT
                                                                                                             (3)))))))))))))),
                                                                                                newExp
                                                                                                (EXP_TYPE_LET,
                                                                                                 EXP_VAL_LET
                                                                                                 (newExpLet
                                                                                                  (newAexpVar
                                                                                                   ("f"),
                                                                                                   newExp
                                                                                                   (EXP_TYPE_CEXP,
                                                                                                    EXP_VAL_CEXP
                                                                                                    (newCexp
                                                                                                     (CEXP_TYPE_APPLY,
                                                                                                      CEXP_VAL_APPLY
                                                                                                      (newCexpApply
                                                                                                       (newAexp
                                                                                                        (AEXP_TYPE_VAR,
                                                                                                         AEXP_VAL_VAR
                                                                                                         (newAexpVar
                                                                                                          ("require"))),
                                                                                                        newAexpList
                                                                                                        (NULL,
                                                                                                         newAexp
                                                                                                         (AEXP_TYPE_PRIM,
                                                                                                          AEXP_VAL_PRIM
                                                                                                          (newAexpPrimApp
                                                                                                           (AEXP_PRIM_XOR,
                                                                                                            newAexp
                                                                                                            (AEXP_TYPE_PRIM,
                                                                                                             AEXP_VAL_PRIM
                                                                                                             (newAexpPrimApp
                                                                                                              (AEXP_PRIM_EQ,
                                                                                                               newAexp
                                                                                                               (AEXP_TYPE_VAR,
                                                                                                                AEXP_VAL_VAR
                                                                                                                (newAexpVar
                                                                                                                 ("ethel"))),
                                                                                                               newAexp
                                                                                                               (AEXP_TYPE_INT,
                                                                                                                AEXP_VAL_INT
                                                                                                                (1))))),
                                                                                                            newAexp
                                                                                                            (AEXP_TYPE_PRIM,
                                                                                                             AEXP_VAL_PRIM
                                                                                                             (newAexpPrimApp
                                                                                                              (AEXP_PRIM_EQ,
                                                                                                               newAexp
                                                                                                               (AEXP_TYPE_VAR,
                                                                                                                AEXP_VAL_VAR
                                                                                                                (newAexpVar
                                                                                                                 ("joan"))),
                                                                                                               newAexp
                                                                                                               (AEXP_TYPE_INT,
                                                                                                                AEXP_VAL_INT
                                                                                                                (2)))))))))))))),
                                                                                                   newExp
                                                                                                   (EXP_TYPE_LET,
                                                                                                    EXP_VAL_LET
                                                                                                    (newExpLet
                                                                                                     (newAexpVar
                                                                                                      ("f"),
                                                                                                      newExp
                                                                                                      (EXP_TYPE_CEXP,
                                                                                                       EXP_VAL_CEXP
                                                                                                       (newCexp
                                                                                                        (CEXP_TYPE_APPLY,
                                                                                                         CEXP_VAL_APPLY
                                                                                                         (newCexpApply
                                                                                                          (newAexp
                                                                                                           (AEXP_TYPE_VAR,
                                                                                                            AEXP_VAL_VAR
                                                                                                            (newAexpVar
                                                                                                             ("require"))),
                                                                                                           newAexpList
                                                                                                           (NULL,
                                                                                                            newAexp
                                                                                                            (AEXP_TYPE_PRIM,
                                                                                                             AEXP_VAL_PRIM
                                                                                                             (newAexpPrimApp
                                                                                                              (AEXP_PRIM_XOR,
                                                                                                               newAexp
                                                                                                               (AEXP_TYPE_PRIM,
                                                                                                                AEXP_VAL_PRIM
                                                                                                                (newAexpPrimApp
                                                                                                                 (AEXP_PRIM_EQ,
                                                                                                                  newAexp
                                                                                                                  (AEXP_TYPE_VAR,
                                                                                                                   AEXP_VAL_VAR
                                                                                                                   (newAexpVar
                                                                                                                    ("joan"))),
                                                                                                                  newAexp
                                                                                                                  (AEXP_TYPE_INT,
                                                                                                                   AEXP_VAL_INT
                                                                                                                   (3))))),
                                                                                                               newAexp
                                                                                                               (AEXP_TYPE_PRIM,
                                                                                                                AEXP_VAL_PRIM
                                                                                                                (newAexpPrimApp
                                                                                                                 (AEXP_PRIM_EQ,
                                                                                                                  newAexp
                                                                                                                  (AEXP_TYPE_VAR,
                                                                                                                   AEXP_VAL_VAR
                                                                                                                   (newAexpVar
                                                                                                                    ("ethel"))),
                                                                                                                  newAexp
                                                                                                                  (AEXP_TYPE_INT,
                                                                                                                   AEXP_VAL_INT
                                                                                                                   (5)))))))))))))),
                                                                                                      newExp
                                                                                                      (EXP_TYPE_LET,
                                                                                                       EXP_VAL_LET
                                                                                                       (newExpLet
                                                                                                        (newAexpVar
                                                                                                         ("f"),
                                                                                                         newExp
                                                                                                         (EXP_TYPE_CEXP,
                                                                                                          EXP_VAL_CEXP
                                                                                                          (newCexp
                                                                                                           (CEXP_TYPE_APPLY,
                                                                                                            CEXP_VAL_APPLY
                                                                                                            (newCexpApply
                                                                                                             (newAexp
                                                                                                              (AEXP_TYPE_VAR,
                                                                                                               AEXP_VAL_VAR
                                                                                                               (newAexpVar
                                                                                                                ("require"))),
                                                                                                              newAexpList
                                                                                                              (NULL,
                                                                                                               newAexp
                                                                                                               (AEXP_TYPE_PRIM,
                                                                                                                AEXP_VAL_PRIM
                                                                                                                (newAexpPrimApp
                                                                                                                 (AEXP_PRIM_XOR,
                                                                                                                  newAexp
                                                                                                                  (AEXP_TYPE_PRIM,
                                                                                                                   AEXP_VAL_PRIM
                                                                                                                   (newAexpPrimApp
                                                                                                                    (AEXP_PRIM_EQ,
                                                                                                                     newAexp
                                                                                                                     (AEXP_TYPE_VAR,
                                                                                                                      AEXP_VAL_VAR
                                                                                                                      (newAexpVar
                                                                                                                       ("joan"))),
                                                                                                                     newAexp
                                                                                                                     (AEXP_TYPE_INT,
                                                                                                                      AEXP_VAL_INT
                                                                                                                      (3))))),
                                                                                                                  newAexp
                                                                                                                  (AEXP_TYPE_PRIM,
                                                                                                                   AEXP_VAL_PRIM
                                                                                                                   (newAexpPrimApp
                                                                                                                    (AEXP_PRIM_EQ,
                                                                                                                     newAexp
                                                                                                                     (AEXP_TYPE_VAR,
                                                                                                                      AEXP_VAL_VAR
                                                                                                                      (newAexpVar
                                                                                                                       ("ethel"))),
                                                                                                                     newAexp
                                                                                                                     (AEXP_TYPE_INT,
                                                                                                                      AEXP_VAL_INT
                                                                                                                      (5)))))))))))))),
                                                                                                         newExp
                                                                                                         (EXP_TYPE_LET,
                                                                                                          EXP_VAL_LET
                                                                                                          (newExpLet
                                                                                                           (newAexpVar
                                                                                                            ("f"),
                                                                                                            newExp
                                                                                                            (EXP_TYPE_CEXP,
                                                                                                             EXP_VAL_CEXP
                                                                                                             (newCexp
                                                                                                              (CEXP_TYPE_APPLY,
                                                                                                               CEXP_VAL_APPLY
                                                                                                               (newCexpApply
                                                                                                                (newAexp
                                                                                                                 (AEXP_TYPE_VAR,
                                                                                                                  AEXP_VAL_VAR
                                                                                                                  (newAexpVar
                                                                                                                   ("require"))),
                                                                                                                 newAexpList
                                                                                                                 (NULL,
                                                                                                                  newAexp
                                                                                                                  (AEXP_TYPE_PRIM,
                                                                                                                   AEXP_VAL_PRIM
                                                                                                                   (newAexpPrimApp
                                                                                                                    (AEXP_PRIM_XOR,
                                                                                                                     newAexp
                                                                                                                     (AEXP_TYPE_PRIM,
                                                                                                                      AEXP_VAL_PRIM
                                                                                                                      (newAexpPrimApp
                                                                                                                       (AEXP_PRIM_EQ,
                                                                                                                        newAexp
                                                                                                                        (AEXP_TYPE_VAR,
                                                                                                                         AEXP_VAL_VAR
                                                                                                                         (newAexpVar
                                                                                                                          ("kitty"))),
                                                                                                                        newAexp
                                                                                                                        (AEXP_TYPE_INT,
                                                                                                                         AEXP_VAL_INT
                                                                                                                         (2))))),
                                                                                                                     newAexp
                                                                                                                     (AEXP_TYPE_PRIM,
                                                                                                                      AEXP_VAL_PRIM
                                                                                                                      (newAexpPrimApp
                                                                                                                       (AEXP_PRIM_EQ,
                                                                                                                        newAexp
                                                                                                                        (AEXP_TYPE_VAR,
                                                                                                                         AEXP_VAL_VAR
                                                                                                                         (newAexpVar
                                                                                                                          ("mary"))),
                                                                                                                        newAexp
                                                                                                                        (AEXP_TYPE_INT,
                                                                                                                         AEXP_VAL_INT
                                                                                                                         (4)))))))))))))),
                                                                                                            newExp
                                                                                                            (EXP_TYPE_LET,
                                                                                                             EXP_VAL_LET
                                                                                                             (newExpLet
                                                                                                              (newAexpVar
                                                                                                               ("f"),
                                                                                                               newExp
                                                                                                               (EXP_TYPE_CEXP,
                                                                                                                EXP_VAL_CEXP
                                                                                                                (newCexp
                                                                                                                 (CEXP_TYPE_APPLY,
                                                                                                                  CEXP_VAL_APPLY
                                                                                                                  (newCexpApply
                                                                                                                   (newAexp
                                                                                                                    (AEXP_TYPE_VAR,
                                                                                                                     AEXP_VAL_VAR
                                                                                                                     (newAexpVar
                                                                                                                      ("require"))),
                                                                                                                    newAexpList
                                                                                                                    (NULL,
                                                                                                                     newAexp
                                                                                                                     (AEXP_TYPE_PRIM,
                                                                                                                      AEXP_VAL_PRIM
                                                                                                                      (newAexpPrimApp
                                                                                                                       (AEXP_PRIM_XOR,
                                                                                                                        newAexp
                                                                                                                        (AEXP_TYPE_PRIM,
                                                                                                                         AEXP_VAL_PRIM
                                                                                                                         (newAexpPrimApp
                                                                                                                          (AEXP_PRIM_EQ,
                                                                                                                           newAexp
                                                                                                                           (AEXP_TYPE_VAR,
                                                                                                                            AEXP_VAL_VAR
                                                                                                                            (newAexpVar
                                                                                                                             ("mary"))),
                                                                                                                           newAexp
                                                                                                                           (AEXP_TYPE_INT,
                                                                                                                            AEXP_VAL_INT
                                                                                                                            (4))))),
                                                                                                                        newAexp
                                                                                                                        (AEXP_TYPE_PRIM,
                                                                                                                         AEXP_VAL_PRIM
                                                                                                                         (newAexpPrimApp
                                                                                                                          (AEXP_PRIM_EQ,
                                                                                                                           newAexp
                                                                                                                           (AEXP_TYPE_VAR,
                                                                                                                            AEXP_VAL_VAR
                                                                                                                            (newAexpVar
                                                                                                                             ("betty"))),
                                                                                                                           newAexp
                                                                                                                           (AEXP_TYPE_INT,
                                                                                                                            AEXP_VAL_INT
                                                                                                                            (1)))))))))))))),
                                                                                                               newExp
                                                                                                               (EXP_TYPE_AEXP,
                                                                                                                EXP_VAL_AEXP
                                                                                                                (newAexp
                                                                                                                 (AEXP_TYPE_LIST,
                                                                                                                  AEXP_VAL_LIST
                                                                                                                  (newAexpList
                                                                                                                   (newAexpList
                                                                                                                    (newAexpList
                                                                                                                     (newAexpList
                                                                                                                      (newAexpList
                                                                                                                       (NULL,
                                                                                                                        newAexp
                                                                                                                        (AEXP_TYPE_VAR,
                                                                                                                         AEXP_VAL_VAR
                                                                                                                         (newAexpVar
                                                                                                                          ("mary")))),
                                                                                                                       newAexp
                                                                                                                       (AEXP_TYPE_VAR,
                                                                                                                        AEXP_VAL_VAR
                                                                                                                        (newAexpVar
                                                                                                                         ("kitty")))),
                                                                                                                      newAexp
                                                                                                                      (AEXP_TYPE_VAR,
                                                                                                                       AEXP_VAL_VAR
                                                                                                                       (newAexpVar
                                                                                                                        ("joan")))),
                                                                                                                     newAexp
                                                                                                                     (AEXP_TYPE_VAR,
                                                                                                                      AEXP_VAL_VAR
                                                                                                                      (newAexpVar
                                                                                                                       ("ethel")))),
                                                                                                                    newAexp
                                                                                                                    (AEXP_TYPE_VAR,
                                                                                                                     AEXP_VAL_VAR
                                                                                                                     (newAexpVar
                                                                                                                      ("betty"))))))))))))))))))))))))))))))))))))))))))))))))))))))))),
                                                              newExp
                                                              (EXP_TYPE_CEXP,
                                                               EXP_VAL_CEXP
                                                               (newCexp
                                                                (CEXP_TYPE_APPLY,
                                                                 CEXP_VAL_APPLY
                                                                 (newCexpApply
                                                                  (newAexp
                                                                   (AEXP_TYPE_VAR,
                                                                    AEXP_VAL_VAR
                                                                    (newAexpVar
                                                                     ("liars"))),
                                                                   newAexpList
                                                                   (NULL,
                                                                    newAexp
                                                                    (AEXP_TYPE_INT,
                                                                     AEXP_VAL_INT
                                                                     (0))))))))))))))));
}

Exp *
makeTestExpExclude() {
  /* exclude.scm */
  return
    newExp(EXP_TYPE_CEXP,
           EXP_VAL_CEXP(newCexp
                        (CEXP_TYPE_LETREC,
                         CEXP_VAL_LETREC(newCexpLetRec
                                         (newLetRecBindings
                                          (newLetRecBindings
                                           (NULL, newAexpVar("exclude"),
                                            newAexp(AEXP_TYPE_LAM,
                                                    AEXP_VAL_LAM(newAexpLam
                                                                 (newAexpVarList
                                                                  (newAexpVarList
                                                                   (NULL,
                                                                    newAexpVar
                                                                    ("lst")),
                                                                   newAexpVar
                                                                   ("items")),
                                                                  newExp
                                                                  (EXP_TYPE_CEXP,
                                                                   EXP_VAL_CEXP
                                                                   (newCexp
                                                                    (CEXP_TYPE_COND,
                                                                     CEXP_VAL_COND
                                                                     (newCexpCond
                                                                      (newAexp
                                                                       (AEXP_TYPE_VAR,
                                                                        AEXP_VAL_VAR
                                                                        (newAexpVar
                                                                         ("lst"))),
                                                                       newExp
                                                                       (EXP_TYPE_LET,
                                                                        EXP_VAL_LET
                                                                        (newExpLet
                                                                         (newAexpVar
                                                                          ("mem"),
                                                                          newExp
                                                                          (EXP_TYPE_CEXP,
                                                                           EXP_VAL_CEXP
                                                                           (newCexp
                                                                            (CEXP_TYPE_APPLY,
                                                                             CEXP_VAL_APPLY
                                                                             (newCexpApply
                                                                              (newAexp
                                                                               (AEXP_TYPE_VAR,
                                                                                AEXP_VAL_VAR
                                                                                (newAexpVar
                                                                                 ("member"))),
                                                                               newAexpList
                                                                               (newAexpList
                                                                                (NULL,
                                                                                 newAexp
                                                                                 (AEXP_TYPE_VAR,
                                                                                  AEXP_VAL_VAR
                                                                                  (newAexpVar
                                                                                   ("items")))),
                                                                                newAexp
                                                                                (AEXP_TYPE_UNARY,
                                                                                 AEXP_VAL_UNARY
                                                                                 (newAexpUnaryApp
                                                                                  (AEXP_UNARY_CAR,
                                                                                   newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("lst")))))))))))),
                                                                          newExp
                                                                          (EXP_TYPE_CEXP,
                                                                           EXP_VAL_CEXP
                                                                           (newCexp
                                                                            (CEXP_TYPE_COND,
                                                                             CEXP_VAL_COND
                                                                             (newCexpCond
                                                                              (newAexp
                                                                               (AEXP_TYPE_VAR,
                                                                                AEXP_VAL_VAR
                                                                                (newAexpVar
                                                                                 ("mem"))),
                                                                               newExp
                                                                               (EXP_TYPE_CEXP,
                                                                                EXP_VAL_CEXP
                                                                                (newCexp
                                                                                 (CEXP_TYPE_APPLY,
                                                                                  CEXP_VAL_APPLY
                                                                                  (newCexpApply
                                                                                   (newAexp
                                                                                    (AEXP_TYPE_VAR,
                                                                                     AEXP_VAL_VAR
                                                                                     (newAexpVar
                                                                                      ("exclude"))),
                                                                                    newAexpList
                                                                                    (newAexpList
                                                                                     (NULL,
                                                                                      newAexp
                                                                                      (AEXP_TYPE_UNARY,
                                                                                       AEXP_VAL_UNARY
                                                                                       (newAexpUnaryApp
                                                                                        (AEXP_UNARY_CDR,
                                                                                         newAexp
                                                                                         (AEXP_TYPE_VAR,
                                                                                          AEXP_VAL_VAR
                                                                                          (newAexpVar
                                                                                           ("lst"))))))),
                                                                                     newAexp
                                                                                     (AEXP_TYPE_VAR,
                                                                                      AEXP_VAL_VAR
                                                                                      (newAexpVar
                                                                                       ("items"))))))))),
                                                                               newExp
                                                                               (EXP_TYPE_LET,
                                                                                EXP_VAL_LET
                                                                                (newExpLet
                                                                                 (newAexpVar
                                                                                  ("excluded"),
                                                                                  newExp
                                                                                  (EXP_TYPE_CEXP,
                                                                                   EXP_VAL_CEXP
                                                                                   (newCexp
                                                                                    (CEXP_TYPE_APPLY,
                                                                                     CEXP_VAL_APPLY
                                                                                     (newCexpApply
                                                                                      (newAexp
                                                                                       (AEXP_TYPE_VAR,
                                                                                        AEXP_VAL_VAR
                                                                                        (newAexpVar
                                                                                         ("exclude"))),
                                                                                       newAexpList
                                                                                       (newAexpList
                                                                                        (NULL,
                                                                                         newAexp
                                                                                         (AEXP_TYPE_UNARY,
                                                                                          AEXP_VAL_UNARY
                                                                                          (newAexpUnaryApp
                                                                                           (AEXP_UNARY_CDR,
                                                                                            newAexp
                                                                                            (AEXP_TYPE_VAR,
                                                                                             AEXP_VAL_VAR
                                                                                             (newAexpVar
                                                                                              ("lst"))))))),
                                                                                        newAexp
                                                                                        (AEXP_TYPE_VAR,
                                                                                         AEXP_VAL_VAR
                                                                                         (newAexpVar
                                                                                          ("items"))))))))),
                                                                                  newExp
                                                                                  (EXP_TYPE_AEXP,
                                                                                   EXP_VAL_AEXP
                                                                                   (newAexp
                                                                                    (AEXP_TYPE_PRIM,
                                                                                     AEXP_VAL_PRIM
                                                                                     (newAexpPrimApp
                                                                                      (AEXP_PRIM_CONS,
                                                                                       newAexp
                                                                                       (AEXP_TYPE_UNARY,
                                                                                        AEXP_VAL_UNARY
                                                                                        (newAexpUnaryApp
                                                                                         (AEXP_UNARY_CAR,
                                                                                          newAexp
                                                                                          (AEXP_TYPE_VAR,
                                                                                           AEXP_VAL_VAR
                                                                                           (newAexpVar
                                                                                            ("lst")))))),
                                                                                       newAexp
                                                                                       (AEXP_TYPE_VAR,
                                                                                        AEXP_VAL_VAR
                                                                                        (newAexpVar
                                                                                         ("excluded"))))))))))))))))))),
                                                                       newExp
                                                                       (EXP_TYPE_AEXP,
                                                                        EXP_VAL_AEXP
                                                                        (newAexp
                                                                         (AEXP_TYPE_VOID,
                                                                          AEXP_VAL_VOID
                                                                          ())))))))))))),
                                           newAexpVar("member"),
                                           newAexp(AEXP_TYPE_LAM,
                                                   AEXP_VAL_LAM(newAexpLam
                                                                (newAexpVarList
                                                                 (newAexpVarList
                                                                  (NULL,
                                                                   newAexpVar
                                                                   ("lst")),
                                                                  newAexpVar
                                                                  ("item")),
                                                                 newExp
                                                                 (EXP_TYPE_CEXP,
                                                                  EXP_VAL_CEXP
                                                                  (newCexp
                                                                   (CEXP_TYPE_COND,
                                                                    CEXP_VAL_COND
                                                                    (newCexpCond
                                                                     (newAexp
                                                                      (AEXP_TYPE_VAR,
                                                                       AEXP_VAL_VAR
                                                                       (newAexpVar
                                                                        ("lst"))),
                                                                      newExp
                                                                      (EXP_TYPE_CEXP,
                                                                       EXP_VAL_CEXP
                                                                       (newCexp
                                                                        (CEXP_TYPE_BOOL,
                                                                         CEXP_VAL_BOOL
                                                                         (newCexpBool
                                                                          (BOOL_TYPE_OR,
                                                                           newExp
                                                                           (EXP_TYPE_AEXP,
                                                                            EXP_VAL_AEXP
                                                                            (newAexp
                                                                             (AEXP_TYPE_PRIM,
                                                                              AEXP_VAL_PRIM
                                                                              (newAexpPrimApp
                                                                               (AEXP_PRIM_EQ,
                                                                                newAexp
                                                                                (AEXP_TYPE_VAR,
                                                                                 AEXP_VAL_VAR
                                                                                 (newAexpVar
                                                                                  ("item"))),
                                                                                newAexp
                                                                                (AEXP_TYPE_UNARY,
                                                                                 AEXP_VAL_UNARY
                                                                                 (newAexpUnaryApp
                                                                                  (AEXP_UNARY_CAR,
                                                                                   newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("lst"))))))))))),
                                                                           newExp
                                                                           (EXP_TYPE_CEXP,
                                                                            EXP_VAL_CEXP
                                                                            (newCexp
                                                                             (CEXP_TYPE_APPLY,
                                                                              CEXP_VAL_APPLY
                                                                              (newCexpApply
                                                                               (newAexp
                                                                                (AEXP_TYPE_VAR,
                                                                                 AEXP_VAL_VAR
                                                                                 (newAexpVar
                                                                                  ("member"))),
                                                                                newAexpList
                                                                                (newAexpList
                                                                                 (NULL,
                                                                                  newAexp
                                                                                  (AEXP_TYPE_UNARY,
                                                                                   AEXP_VAL_UNARY
                                                                                   (newAexpUnaryApp
                                                                                    (AEXP_UNARY_CDR,
                                                                                     newAexp
                                                                                     (AEXP_TYPE_VAR,
                                                                                      AEXP_VAL_VAR
                                                                                      (newAexpVar
                                                                                       ("lst"))))))),
                                                                                 newAexp
                                                                                 (AEXP_TYPE_VAR,
                                                                                  AEXP_VAL_VAR
                                                                                  (newAexpVar
                                                                                   ("item")))))))))))))),
                                                                      newExp
                                                                      (EXP_TYPE_AEXP,
                                                                       EXP_VAL_AEXP
                                                                       (newAexp
                                                                        (AEXP_TYPE_FALSE,
                                                                         AEXP_VAL_FALSE
                                                                         ())))))))))))),
                                          newExp(EXP_TYPE_LET,
                                                 EXP_VAL_LET(newExpLet
                                                             (newAexpVar("a"),
                                                              newExp
                                                              (EXP_TYPE_AEXP,
                                                               EXP_VAL_AEXP
                                                               (newAexp
                                                                (AEXP_TYPE_LIST,
                                                                 AEXP_VAL_LIST
                                                                 (newAexpList
                                                                  (newAexpList
                                                                   (NULL,
                                                                    newAexp
                                                                    (AEXP_TYPE_INT,
                                                                     AEXP_VAL_INT
                                                                     (3))),
                                                                   newAexp
                                                                   (AEXP_TYPE_INT,
                                                                    AEXP_VAL_INT
                                                                    (2))))))),
                                                              newExp
                                                              (EXP_TYPE_LET,
                                                               EXP_VAL_LET
                                                               (newExpLet
                                                                (newAexpVar
                                                                 ("b"),
                                                                 newExp
                                                                 (EXP_TYPE_AEXP,
                                                                  EXP_VAL_AEXP
                                                                  (newAexp
                                                                   (AEXP_TYPE_LIST,
                                                                    AEXP_VAL_LIST
                                                                    (newAexpList
                                                                     (newAexpList
                                                                      (newAexpList
                                                                       (newAexpList
                                                                        (newAexpList
                                                                         (NULL,
                                                                          newAexp
                                                                          (AEXP_TYPE_INT,
                                                                           AEXP_VAL_INT
                                                                           (5))),
                                                                         newAexp
                                                                         (AEXP_TYPE_INT,
                                                                          AEXP_VAL_INT
                                                                          (4))),
                                                                        newAexp
                                                                        (AEXP_TYPE_INT,
                                                                         AEXP_VAL_INT
                                                                         (3))),
                                                                       newAexp
                                                                       (AEXP_TYPE_INT,
                                                                        AEXP_VAL_INT
                                                                        (2))),
                                                                      newAexp
                                                                      (AEXP_TYPE_INT,
                                                                       AEXP_VAL_INT
                                                                       (1))))))),
                                                                 newExp
                                                                 (EXP_TYPE_CEXP,
                                                                  EXP_VAL_CEXP
                                                                  (newCexp
                                                                   (CEXP_TYPE_APPLY,
                                                                    CEXP_VAL_APPLY
                                                                    (newCexpApply
                                                                     (newAexp
                                                                      (AEXP_TYPE_VAR,
                                                                       AEXP_VAL_VAR
                                                                       (newAexpVar
                                                                        ("exclude"))),
                                                                      newAexpList
                                                                      (newAexpList
                                                                       (NULL,
                                                                        newAexp
                                                                        (AEXP_TYPE_VAR,
                                                                         AEXP_VAL_VAR
                                                                         (newAexpVar
                                                                          ("b")))),
                                                                       newAexp
                                                                       (AEXP_TYPE_VAR,
                                                                        AEXP_VAL_VAR
                                                                        (newAexpVar
                                                                         ("a"))))))))))))))))))));
}

Exp *
makeTestExpBeer() {
    /* beer.scm */
    return
        newExp(EXP_TYPE_CEXP,
               EXP_VAL_CEXP(newCexp
                            (CEXP_TYPE_LETREC,
                             CEXP_VAL_LETREC(newCexpLetRec
                                             (newLetRecBindings
                                              (newLetRecBindings
                                               (newLetRecBindings
                                                (newLetRecBindings
                                                 (newLetRecBindings
                                                  (newLetRecBindings
                                                   (newLetRecBindings
                                                    (NULL, newAexpVar("sum"),
                                                     newAexp(AEXP_TYPE_LAM,
                                                             AEXP_VAL_LAM
                                                             (newAexpLam
                                                              (newAexpVarList
                                                               (NULL,
                                                                newAexpVar
                                                                ("lst")),
                                                               newExp
                                                               (EXP_TYPE_CEXP,
                                                                EXP_VAL_CEXP
                                                                (newCexp
                                                                 (CEXP_TYPE_COND,
                                                                  CEXP_VAL_COND
                                                                  (newCexpCond
                                                                   (newAexp
                                                                    (AEXP_TYPE_VAR,
                                                                     AEXP_VAL_VAR
                                                                     (newAexpVar
                                                                      ("lst"))),
                                                                    newExp
                                                                    (EXP_TYPE_LET,
                                                                     EXP_VAL_LET
                                                                     (newExpLet
                                                                      (newAexpVar
                                                                       ("rest"),
                                                                       newExp
                                                                       (EXP_TYPE_CEXP,
                                                                        EXP_VAL_CEXP
                                                                        (newCexp
                                                                         (CEXP_TYPE_APPLY,
                                                                          CEXP_VAL_APPLY
                                                                          (newCexpApply
                                                                           (newAexp
                                                                            (AEXP_TYPE_VAR,
                                                                             AEXP_VAL_VAR
                                                                             (newAexpVar
                                                                              ("sum"))),
                                                                            newAexpList
                                                                            (NULL,
                                                                             newAexp
                                                                             (AEXP_TYPE_UNARY,
                                                                              AEXP_VAL_UNARY
                                                                              (newAexpUnaryApp
                                                                               (AEXP_UNARY_CDR,
                                                                                newAexp
                                                                                (AEXP_TYPE_VAR,
                                                                                 AEXP_VAL_VAR
                                                                                 (newAexpVar
                                                                                  ("lst")))))))))))),
                                                                       newExp
                                                                       (EXP_TYPE_AEXP,
                                                                        EXP_VAL_AEXP
                                                                        (newAexp
                                                                         (AEXP_TYPE_PRIM,
                                                                          AEXP_VAL_PRIM
                                                                          (newAexpPrimApp
                                                                           (AEXP_PRIM_ADD,
                                                                            newAexp
                                                                            (AEXP_TYPE_UNARY,
                                                                             AEXP_VAL_UNARY
                                                                             (newAexpUnaryApp
                                                                              (AEXP_UNARY_CAR,
                                                                               newAexp
                                                                               (AEXP_TYPE_VAR,
                                                                                AEXP_VAL_VAR
                                                                                (newAexpVar
                                                                                 ("lst")))))),
                                                                            newAexp
                                                                            (AEXP_TYPE_VAR,
                                                                             AEXP_VAL_VAR
                                                                             (newAexpVar
                                                                              ("rest"))))))))))),
                                                                    newExp
                                                                    (EXP_TYPE_AEXP,
                                                                     EXP_VAL_AEXP
                                                                     (newAexp
                                                                      (AEXP_TYPE_INT,
                                                                       AEXP_VAL_INT
                                                                       (0))))))))))))),
                                                    newAexpVar("some-of"),
                                                    newAexp(AEXP_TYPE_LAM,
                                                            AEXP_VAL_LAM
                                                            (newAexpLam
                                                             (newAexpVarList
                                                              (NULL,
                                                               newAexpVar
                                                               ("lst")),
                                                              newExp
                                                              (EXP_TYPE_LET,
                                                               EXP_VAL_LET
                                                               (newExpLet
                                                                (newAexpVar
                                                                 ("f"),
                                                                 newExp
                                                                 (EXP_TYPE_CEXP,
                                                                  EXP_VAL_CEXP
                                                                  (newCexp
                                                                   (CEXP_TYPE_APPLY,
                                                                    CEXP_VAL_APPLY
                                                                    (newCexpApply
                                                                     (newAexp
                                                                      (AEXP_TYPE_VAR,
                                                                       AEXP_VAL_VAR
                                                                       (newAexpVar
                                                                        ("require"))),
                                                                      newAexpList
                                                                      (NULL,
                                                                       newAexp
                                                                       (AEXP_TYPE_VAR,
                                                                        AEXP_VAL_VAR
                                                                        (newAexpVar
                                                                         ("lst"))))))))),
                                                                 newExp
                                                                 (EXP_TYPE_CEXP,
                                                                  EXP_VAL_CEXP
                                                                  (newCexp
                                                                   (CEXP_TYPE_AMB,
                                                                    CEXP_VAL_AMB
                                                                    (newCexpAmb
                                                                     (newExp
                                                                      (EXP_TYPE_AEXP,
                                                                       EXP_VAL_AEXP
                                                                       (newAexp
                                                                        (AEXP_TYPE_LIST,
                                                                         AEXP_VAL_LIST
                                                                         (newAexpList
                                                                          (NULL,
                                                                           newAexp
                                                                           (AEXP_TYPE_UNARY,
                                                                            AEXP_VAL_UNARY
                                                                            (newAexpUnaryApp
                                                                             (AEXP_UNARY_CAR,
                                                                              newAexp
                                                                              (AEXP_TYPE_VAR,
                                                                               AEXP_VAL_VAR
                                                                               (newAexpVar
                                                                                ("lst"))))))))))),
                                                                      newExp
                                                                      (EXP_TYPE_CEXP,
                                                                       EXP_VAL_CEXP
                                                                       (newCexp
                                                                        (CEXP_TYPE_AMB,
                                                                         CEXP_VAL_AMB
                                                                         (newCexpAmb
                                                                          (newExp
                                                                           (EXP_TYPE_CEXP,
                                                                            EXP_VAL_CEXP
                                                                            (newCexp
                                                                             (CEXP_TYPE_APPLY,
                                                                              CEXP_VAL_APPLY
                                                                              (newCexpApply
                                                                               (newAexp
                                                                                (AEXP_TYPE_VAR,
                                                                                 AEXP_VAL_VAR
                                                                                 (newAexpVar
                                                                                  ("some-of"))),
                                                                                newAexpList
                                                                                (NULL,
                                                                                 newAexp
                                                                                 (AEXP_TYPE_UNARY,
                                                                                  AEXP_VAL_UNARY
                                                                                  (newAexpUnaryApp
                                                                                   (AEXP_UNARY_CDR,
                                                                                    newAexp
                                                                                    (AEXP_TYPE_VAR,
                                                                                     AEXP_VAL_VAR
                                                                                     (newAexpVar
                                                                                      ("lst")))))))))))),
                                                                           newExp
                                                                           (EXP_TYPE_LET,
                                                                            EXP_VAL_LET
                                                                            (newExpLet
                                                                             (newAexpVar
                                                                              ("rest"),
                                                                              newExp
                                                                              (EXP_TYPE_CEXP,
                                                                               EXP_VAL_CEXP
                                                                               (newCexp
                                                                                (CEXP_TYPE_APPLY,
                                                                                 CEXP_VAL_APPLY
                                                                                 (newCexpApply
                                                                                  (newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("some-of"))),
                                                                                   newAexpList
                                                                                   (NULL,
                                                                                    newAexp
                                                                                    (AEXP_TYPE_UNARY,
                                                                                     AEXP_VAL_UNARY
                                                                                     (newAexpUnaryApp
                                                                                      (AEXP_UNARY_CDR,
                                                                                       newAexp
                                                                                       (AEXP_TYPE_VAR,
                                                                                        AEXP_VAL_VAR
                                                                                        (newAexpVar
                                                                                         ("lst")))))))))))),
                                                                              newExp
                                                                              (EXP_TYPE_AEXP,
                                                                               EXP_VAL_AEXP
                                                                               (newAexp
                                                                                (AEXP_TYPE_PRIM,
                                                                                 AEXP_VAL_PRIM
                                                                                 (newAexpPrimApp
                                                                                  (AEXP_PRIM_CONS,
                                                                                   newAexp
                                                                                   (AEXP_TYPE_UNARY,
                                                                                    AEXP_VAL_UNARY
                                                                                    (newAexpUnaryApp
                                                                                     (AEXP_UNARY_CAR,
                                                                                      newAexp
                                                                                      (AEXP_TYPE_VAR,
                                                                                       AEXP_VAL_VAR
                                                                                       (newAexpVar
                                                                                        ("lst")))))),
                                                                                   newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("rest")))))))))))))))))))))))))))),
                                                   newAexpVar("exclude"),
                                                   newAexp(AEXP_TYPE_LAM,
                                                           AEXP_VAL_LAM
                                                           (newAexpLam
                                                            (newAexpVarList
                                                             (newAexpVarList
                                                              (NULL,
                                                               newAexpVar
                                                               ("lst")),
                                                              newAexpVar
                                                              ("items")),
                                                             newExp
                                                             (EXP_TYPE_CEXP,
                                                              EXP_VAL_CEXP
                                                              (newCexp
                                                               (CEXP_TYPE_COND,
                                                                CEXP_VAL_COND
                                                                (newCexpCond
                                                                 (newAexp
                                                                  (AEXP_TYPE_VAR,
                                                                   AEXP_VAL_VAR
                                                                   (newAexpVar
                                                                    ("lst"))),
                                                                  newExp
                                                                  (EXP_TYPE_LET,
                                                                   EXP_VAL_LET
                                                                   (newExpLet
                                                                    (newAexpVar
                                                                     ("mem"),
                                                                     newExp
                                                                     (EXP_TYPE_CEXP,
                                                                      EXP_VAL_CEXP
                                                                      (newCexp
                                                                       (CEXP_TYPE_APPLY,
                                                                        CEXP_VAL_APPLY
                                                                        (newCexpApply
                                                                         (newAexp
                                                                          (AEXP_TYPE_VAR,
                                                                           AEXP_VAL_VAR
                                                                           (newAexpVar
                                                                            ("member"))),
                                                                          newAexpList
                                                                          (newAexpList
                                                                           (NULL,
                                                                            newAexp
                                                                            (AEXP_TYPE_VAR,
                                                                             AEXP_VAL_VAR
                                                                             (newAexpVar
                                                                              ("items")))),
                                                                           newAexp
                                                                           (AEXP_TYPE_UNARY,
                                                                            AEXP_VAL_UNARY
                                                                            (newAexpUnaryApp
                                                                             (AEXP_UNARY_CAR,
                                                                              newAexp
                                                                              (AEXP_TYPE_VAR,
                                                                               AEXP_VAL_VAR
                                                                               (newAexpVar
                                                                                ("lst")))))))))))),
                                                                     newExp
                                                                     (EXP_TYPE_CEXP,
                                                                      EXP_VAL_CEXP
                                                                      (newCexp
                                                                       (CEXP_TYPE_COND,
                                                                        CEXP_VAL_COND
                                                                        (newCexpCond
                                                                         (newAexp
                                                                          (AEXP_TYPE_VAR,
                                                                           AEXP_VAL_VAR
                                                                           (newAexpVar
                                                                            ("mem"))),
                                                                          newExp
                                                                          (EXP_TYPE_CEXP,
                                                                           EXP_VAL_CEXP
                                                                           (newCexp
                                                                            (CEXP_TYPE_APPLY,
                                                                             CEXP_VAL_APPLY
                                                                             (newCexpApply
                                                                              (newAexp
                                                                               (AEXP_TYPE_VAR,
                                                                                AEXP_VAL_VAR
                                                                                (newAexpVar
                                                                                 ("exclude"))),
                                                                               newAexpList
                                                                               (newAexpList
                                                                                (NULL,
                                                                                 newAexp
                                                                                 (AEXP_TYPE_UNARY,
                                                                                  AEXP_VAL_UNARY
                                                                                  (newAexpUnaryApp
                                                                                   (AEXP_UNARY_CDR,
                                                                                    newAexp
                                                                                    (AEXP_TYPE_VAR,
                                                                                     AEXP_VAL_VAR
                                                                                     (newAexpVar
                                                                                      ("lst"))))))),
                                                                                newAexp
                                                                                (AEXP_TYPE_VAR,
                                                                                 AEXP_VAL_VAR
                                                                                 (newAexpVar
                                                                                  ("items"))))))))),
                                                                          newExp
                                                                          (EXP_TYPE_LET,
                                                                           EXP_VAL_LET
                                                                           (newExpLet
                                                                            (newAexpVar
                                                                             ("excluded"),
                                                                             newExp
                                                                             (EXP_TYPE_CEXP,
                                                                              EXP_VAL_CEXP
                                                                              (newCexp
                                                                               (CEXP_TYPE_APPLY,
                                                                                CEXP_VAL_APPLY
                                                                                (newCexpApply
                                                                                 (newAexp
                                                                                  (AEXP_TYPE_VAR,
                                                                                   AEXP_VAL_VAR
                                                                                   (newAexpVar
                                                                                    ("exclude"))),
                                                                                  newAexpList
                                                                                  (newAexpList
                                                                                   (NULL,
                                                                                    newAexp
                                                                                    (AEXP_TYPE_UNARY,
                                                                                     AEXP_VAL_UNARY
                                                                                     (newAexpUnaryApp
                                                                                      (AEXP_UNARY_CDR,
                                                                                       newAexp
                                                                                       (AEXP_TYPE_VAR,
                                                                                        AEXP_VAL_VAR
                                                                                        (newAexpVar
                                                                                         ("lst"))))))),
                                                                                   newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("items"))))))))),
                                                                             newExp
                                                                             (EXP_TYPE_AEXP,
                                                                              EXP_VAL_AEXP
                                                                              (newAexp
                                                                               (AEXP_TYPE_PRIM,
                                                                                AEXP_VAL_PRIM
                                                                                (newAexpPrimApp
                                                                                 (AEXP_PRIM_CONS,
                                                                                  newAexp
                                                                                  (AEXP_TYPE_UNARY,
                                                                                   AEXP_VAL_UNARY
                                                                                   (newAexpUnaryApp
                                                                                    (AEXP_UNARY_CAR,
                                                                                     newAexp
                                                                                     (AEXP_TYPE_VAR,
                                                                                      AEXP_VAL_VAR
                                                                                      (newAexpVar
                                                                                       ("lst")))))),
                                                                                  newAexp
                                                                                  (AEXP_TYPE_VAR,
                                                                                   AEXP_VAL_VAR
                                                                                   (newAexpVar
                                                                                    ("excluded"))))))))))))))))))),
                                                                  newExp
                                                                  (EXP_TYPE_AEXP,
                                                                   EXP_VAL_AEXP
                                                                   (newAexp
                                                                    (AEXP_TYPE_VOID,
                                                                     AEXP_VAL_VOID
                                                                     ())))))))))))),
                                                  newAexpVar("member"),
                                                  newAexp(AEXP_TYPE_LAM,
                                                          AEXP_VAL_LAM
                                                          (newAexpLam
                                                           (newAexpVarList
                                                            (newAexpVarList
                                                             (NULL,
                                                              newAexpVar
                                                              ("lst")),
                                                             newAexpVar
                                                             ("item")),
                                                            newExp
                                                            (EXP_TYPE_CEXP,
                                                             EXP_VAL_CEXP
                                                             (newCexp
                                                              (CEXP_TYPE_COND,
                                                               CEXP_VAL_COND
                                                               (newCexpCond
                                                                (newAexp
                                                                 (AEXP_TYPE_VAR,
                                                                  AEXP_VAL_VAR
                                                                  (newAexpVar
                                                                   ("lst"))),
                                                                 newExp
                                                                 (EXP_TYPE_CEXP,
                                                                  EXP_VAL_CEXP
                                                                  (newCexp
                                                                   (CEXP_TYPE_BOOL,
                                                                    CEXP_VAL_BOOL
                                                                    (newCexpBool
                                                                     (BOOL_TYPE_OR,
                                                                      newExp
                                                                      (EXP_TYPE_AEXP,
                                                                       EXP_VAL_AEXP
                                                                       (newAexp
                                                                        (AEXP_TYPE_PRIM,
                                                                         AEXP_VAL_PRIM
                                                                         (newAexpPrimApp
                                                                          (AEXP_PRIM_EQ,
                                                                           newAexp
                                                                           (AEXP_TYPE_VAR,
                                                                            AEXP_VAL_VAR
                                                                            (newAexpVar
                                                                             ("item"))),
                                                                           newAexp
                                                                           (AEXP_TYPE_UNARY,
                                                                            AEXP_VAL_UNARY
                                                                            (newAexpUnaryApp
                                                                             (AEXP_UNARY_CAR,
                                                                              newAexp
                                                                              (AEXP_TYPE_VAR,
                                                                               AEXP_VAL_VAR
                                                                               (newAexpVar
                                                                                ("lst"))))))))))),
                                                                      newExp
                                                                      (EXP_TYPE_CEXP,
                                                                       EXP_VAL_CEXP
                                                                       (newCexp
                                                                        (CEXP_TYPE_APPLY,
                                                                         CEXP_VAL_APPLY
                                                                         (newCexpApply
                                                                          (newAexp
                                                                           (AEXP_TYPE_VAR,
                                                                            AEXP_VAL_VAR
                                                                            (newAexpVar
                                                                             ("member"))),
                                                                           newAexpList
                                                                           (newAexpList
                                                                            (NULL,
                                                                             newAexp
                                                                             (AEXP_TYPE_UNARY,
                                                                              AEXP_VAL_UNARY
                                                                              (newAexpUnaryApp
                                                                               (AEXP_UNARY_CDR,
                                                                                newAexp
                                                                                (AEXP_TYPE_VAR,
                                                                                 AEXP_VAL_VAR
                                                                                 (newAexpVar
                                                                                  ("lst"))))))),
                                                                            newAexp
                                                                            (AEXP_TYPE_VAR,
                                                                             AEXP_VAL_VAR
                                                                             (newAexpVar
                                                                              ("item")))))))))))))),
                                                                 newExp
                                                                 (EXP_TYPE_AEXP,
                                                                  EXP_VAL_AEXP
                                                                  (newAexp
                                                                   (AEXP_TYPE_FALSE,
                                                                    AEXP_VAL_FALSE
                                                                    ())))))))))))),
                                                 newAexpVar("require"),
                                                 newAexp(AEXP_TYPE_LAM,
                                                         AEXP_VAL_LAM
                                                         (newAexpLam
                                                          (newAexpVarList
                                                           (NULL,
                                                            newAexpVar
                                                            ("condition")),
                                                           newExp
                                                           (EXP_TYPE_CEXP,
                                                            EXP_VAL_CEXP
                                                            (newCexp
                                                             (CEXP_TYPE_BOOL,
                                                              CEXP_VAL_BOOL
                                                              (newCexpBool
                                                               (BOOL_TYPE_OR,
                                                                newExp
                                                                (EXP_TYPE_AEXP,
                                                                 EXP_VAL_AEXP
                                                                 (newAexp
                                                                  (AEXP_TYPE_VAR,
                                                                   AEXP_VAL_VAR
                                                                   (newAexpVar
                                                                    ("condition"))))),
                                                                newExp
                                                                (EXP_TYPE_CEXP,
                                                                 EXP_VAL_CEXP
                                                                 (newCexp
                                                                  (CEXP_TYPE_BACK,
                                                                   CEXP_VAL_BACK
                                                                   ())))))))))))),
                                                newAexpVar("one-of"),
                                                newAexp(AEXP_TYPE_LAM,
                                                        AEXP_VAL_LAM
                                                        (newAexpLam
                                                         (newAexpVarList
                                                          (NULL,
                                                           newAexpVar("lst")),
                                                          newExp(EXP_TYPE_LET,
                                                                 EXP_VAL_LET
                                                                 (newExpLet
                                                                  (newAexpVar
                                                                   ("f"),
                                                                   newExp
                                                                   (EXP_TYPE_CEXP,
                                                                    EXP_VAL_CEXP
                                                                    (newCexp
                                                                     (CEXP_TYPE_APPLY,
                                                                      CEXP_VAL_APPLY
                                                                      (newCexpApply
                                                                       (newAexp
                                                                        (AEXP_TYPE_VAR,
                                                                         AEXP_VAL_VAR
                                                                         (newAexpVar
                                                                          ("require"))),
                                                                        newAexpList
                                                                        (NULL,
                                                                         newAexp
                                                                         (AEXP_TYPE_VAR,
                                                                          AEXP_VAL_VAR
                                                                          (newAexpVar
                                                                           ("lst"))))))))),
                                                                   newExp
                                                                   (EXP_TYPE_CEXP,
                                                                    EXP_VAL_CEXP
                                                                    (newCexp
                                                                     (CEXP_TYPE_AMB,
                                                                      CEXP_VAL_AMB
                                                                      (newCexpAmb
                                                                       (newExp
                                                                        (EXP_TYPE_AEXP,
                                                                         EXP_VAL_AEXP
                                                                         (newAexp
                                                                          (AEXP_TYPE_UNARY,
                                                                           AEXP_VAL_UNARY
                                                                           (newAexpUnaryApp
                                                                            (AEXP_UNARY_CAR,
                                                                             newAexp
                                                                             (AEXP_TYPE_VAR,
                                                                              AEXP_VAL_VAR
                                                                              (newAexpVar
                                                                               ("lst")))))))),
                                                                        newExp
                                                                        (EXP_TYPE_CEXP,
                                                                         EXP_VAL_CEXP
                                                                         (newCexp
                                                                          (CEXP_TYPE_APPLY,
                                                                           CEXP_VAL_APPLY
                                                                           (newCexpApply
                                                                            (newAexp
                                                                             (AEXP_TYPE_VAR,
                                                                              AEXP_VAL_VAR
                                                                              (newAexpVar
                                                                               ("one-of"))),
                                                                             newAexpList
                                                                             (NULL,
                                                                              newAexp
                                                                              (AEXP_TYPE_UNARY,
                                                                               AEXP_VAL_UNARY
                                                                               (newAexpUnaryApp
                                                                                (AEXP_UNARY_CDR,
                                                                                 newAexp
                                                                                 (AEXP_TYPE_VAR,
                                                                                  AEXP_VAL_VAR
                                                                                  (newAexpVar
                                                                                   ("lst")))))))))))))))))))))))),
                                               newAexpVar("barrels-of-fun"),
                                               newAexp(AEXP_TYPE_LAM,
                                                       AEXP_VAL_LAM(newAexpLam
                                                                    (newAexpVarList
                                                                     (NULL,
                                                                      newAexpVar
                                                                      ("ignored")),
                                                                     newExp
                                                                     (EXP_TYPE_LET,
                                                                      EXP_VAL_LET
                                                                      (newExpLet
                                                                       (newAexpVar
                                                                        ("barrels"),
                                                                        newExp
                                                                        (EXP_TYPE_AEXP,
                                                                         EXP_VAL_AEXP
                                                                         (newAexp
                                                                          (AEXP_TYPE_LIST,
                                                                           AEXP_VAL_LIST
                                                                           (newAexpList
                                                                            (newAexpList
                                                                             (newAexpList
                                                                              (newAexpList
                                                                               (newAexpList
                                                                                (newAexpList
                                                                                 (NULL,
                                                                                  newAexp
                                                                                  (AEXP_TYPE_INT,
                                                                                   AEXP_VAL_INT
                                                                                   (62))),
                                                                                 newAexp
                                                                                 (AEXP_TYPE_INT,
                                                                                  AEXP_VAL_INT
                                                                                  (40))),
                                                                                newAexp
                                                                                (AEXP_TYPE_INT,
                                                                                 AEXP_VAL_INT
                                                                                 (38))),
                                                                               newAexp
                                                                               (AEXP_TYPE_INT,
                                                                                AEXP_VAL_INT
                                                                                (36))),
                                                                              newAexp
                                                                              (AEXP_TYPE_INT,
                                                                               AEXP_VAL_INT
                                                                               (32))),
                                                                             newAexp
                                                                             (AEXP_TYPE_INT,
                                                                              AEXP_VAL_INT
                                                                              (30))))))),
                                                                        newExp
                                                                        (EXP_TYPE_LET,
                                                                         EXP_VAL_LET
                                                                         (newExpLet
                                                                          (newAexpVar
                                                                           ("beer"),
                                                                           newExp
                                                                           (EXP_TYPE_CEXP,
                                                                            EXP_VAL_CEXP
                                                                            (newCexp
                                                                             (CEXP_TYPE_APPLY,
                                                                              CEXP_VAL_APPLY
                                                                              (newCexpApply
                                                                               (newAexp
                                                                                (AEXP_TYPE_VAR,
                                                                                 AEXP_VAL_VAR
                                                                                 (newAexpVar
                                                                                  ("one-of"))),
                                                                                newAexpList
                                                                                (NULL,
                                                                                 newAexp
                                                                                 (AEXP_TYPE_VAR,
                                                                                  AEXP_VAL_VAR
                                                                                  (newAexpVar
                                                                                   ("barrels"))))))))),
                                                                           newExp
                                                                           (EXP_TYPE_LET,
                                                                            EXP_VAL_LET
                                                                            (newExpLet
                                                                             (newAexpVar
                                                                              ("wine"),
                                                                              newExp
                                                                              (EXP_TYPE_CEXP,
                                                                               EXP_VAL_CEXP
                                                                               (newCexp
                                                                                (CEXP_TYPE_APPLY,
                                                                                 CEXP_VAL_APPLY
                                                                                 (newCexpApply
                                                                                  (newAexp
                                                                                   (AEXP_TYPE_VAR,
                                                                                    AEXP_VAL_VAR
                                                                                    (newAexpVar
                                                                                     ("exclude"))),
                                                                                   newAexpList
                                                                                   (newAexpList
                                                                                    (NULL,
                                                                                     newAexp
                                                                                     (AEXP_TYPE_VAR,
                                                                                      AEXP_VAL_VAR
                                                                                      (newAexpVar
                                                                                       ("barrels")))),
                                                                                    newAexp
                                                                                    (AEXP_TYPE_LIST,
                                                                                     AEXP_VAL_LIST
                                                                                     (newAexpList
                                                                                      (NULL,
                                                                                       newAexp
                                                                                       (AEXP_TYPE_VAR,
                                                                                        AEXP_VAL_VAR
                                                                                        (newAexpVar
                                                                                         ("beer")))))))))))),
                                                                              newExp
                                                                              (EXP_TYPE_LET,
                                                                               EXP_VAL_LET
                                                                               (newExpLet
                                                                                (newAexpVar
                                                                                 ("barrel-1"),
                                                                                 newExp
                                                                                 (EXP_TYPE_CEXP,
                                                                                  EXP_VAL_CEXP
                                                                                  (newCexp
                                                                                   (CEXP_TYPE_APPLY,
                                                                                    CEXP_VAL_APPLY
                                                                                    (newCexpApply
                                                                                     (newAexp
                                                                                      (AEXP_TYPE_VAR,
                                                                                       AEXP_VAL_VAR
                                                                                       (newAexpVar
                                                                                        ("one-of"))),
                                                                                      newAexpList
                                                                                      (NULL,
                                                                                       newAexp
                                                                                       (AEXP_TYPE_VAR,
                                                                                        AEXP_VAL_VAR
                                                                                        (newAexpVar
                                                                                         ("wine"))))))))),
                                                                                 newExp
                                                                                 (EXP_TYPE_LET,
                                                                                  EXP_VAL_LET
                                                                                  (newExpLet
                                                                                   (newAexpVar
                                                                                    ("except-barrel-1"),
                                                                                    newExp
                                                                                    (EXP_TYPE_CEXP,
                                                                                     EXP_VAL_CEXP
                                                                                     (newCexp
                                                                                      (CEXP_TYPE_APPLY,
                                                                                       CEXP_VAL_APPLY
                                                                                       (newCexpApply
                                                                                        (newAexp
                                                                                         (AEXP_TYPE_VAR,
                                                                                          AEXP_VAL_VAR
                                                                                          (newAexpVar
                                                                                           ("exclude"))),
                                                                                         newAexpList
                                                                                         (newAexpList
                                                                                          (NULL,
                                                                                           newAexp
                                                                                           (AEXP_TYPE_VAR,
                                                                                            AEXP_VAL_VAR
                                                                                            (newAexpVar
                                                                                             ("wine")))),
                                                                                          newAexp
                                                                                          (AEXP_TYPE_LIST,
                                                                                           AEXP_VAL_LIST
                                                                                           (newAexpList
                                                                                            (NULL,
                                                                                             newAexp
                                                                                             (AEXP_TYPE_VAR,
                                                                                              AEXP_VAL_VAR
                                                                                              (newAexpVar
                                                                                               ("barrel-1")))))))))))),
                                                                                    newExp
                                                                                    (EXP_TYPE_LET,
                                                                                     EXP_VAL_LET
                                                                                     (newExpLet
                                                                                      (newAexpVar
                                                                                       ("barrel-2"),
                                                                                       newExp
                                                                                       (EXP_TYPE_CEXP,
                                                                                        EXP_VAL_CEXP
                                                                                        (newCexp
                                                                                         (CEXP_TYPE_APPLY,
                                                                                          CEXP_VAL_APPLY
                                                                                          (newCexpApply
                                                                                           (newAexp
                                                                                            (AEXP_TYPE_VAR,
                                                                                             AEXP_VAL_VAR
                                                                                             (newAexpVar
                                                                                              ("one-of"))),
                                                                                            newAexpList
                                                                                            (NULL,
                                                                                             newAexp
                                                                                             (AEXP_TYPE_VAR,
                                                                                              AEXP_VAL_VAR
                                                                                              (newAexpVar
                                                                                               ("except-barrel-1"))))))))),
                                                                                       newExp
                                                                                       (EXP_TYPE_LET,
                                                                                        EXP_VAL_LET
                                                                                        (newExpLet
                                                                                         (newAexpVar
                                                                                          ("except-barrels-1-and-2"),
                                                                                          newExp
                                                                                          (EXP_TYPE_CEXP,
                                                                                           EXP_VAL_CEXP
                                                                                           (newCexp
                                                                                            (CEXP_TYPE_APPLY,
                                                                                             CEXP_VAL_APPLY
                                                                                             (newCexpApply
                                                                                              (newAexp
                                                                                               (AEXP_TYPE_VAR,
                                                                                                AEXP_VAL_VAR
                                                                                                (newAexpVar
                                                                                                 ("exclude"))),
                                                                                               newAexpList
                                                                                               (newAexpList
                                                                                                (NULL,
                                                                                                 newAexp
                                                                                                 (AEXP_TYPE_VAR,
                                                                                                  AEXP_VAL_VAR
                                                                                                  (newAexpVar
                                                                                                   ("wine")))),
                                                                                                newAexp
                                                                                                (AEXP_TYPE_LIST,
                                                                                                 AEXP_VAL_LIST
                                                                                                 (newAexpList
                                                                                                  (newAexpList
                                                                                                   (NULL,
                                                                                                    newAexp
                                                                                                    (AEXP_TYPE_VAR,
                                                                                                     AEXP_VAL_VAR
                                                                                                     (newAexpVar
                                                                                                      ("barrel-2")))),
                                                                                                   newAexp
                                                                                                   (AEXP_TYPE_VAR,
                                                                                                    AEXP_VAL_VAR
                                                                                                    (newAexpVar
                                                                                                     ("barrel-1")))))))))))),
                                                                                          newExp
                                                                                          (EXP_TYPE_LET,
                                                                                           EXP_VAL_LET
                                                                                           (newExpLet
                                                                                            (newAexpVar
                                                                                             ("purchase"),
                                                                                             newExp
                                                                                             (EXP_TYPE_CEXP,
                                                                                              EXP_VAL_CEXP
                                                                                              (newCexp
                                                                                               (CEXP_TYPE_APPLY,
                                                                                                CEXP_VAL_APPLY
                                                                                                (newCexpApply
                                                                                                 (newAexp
                                                                                                  (AEXP_TYPE_VAR,
                                                                                                   AEXP_VAL_VAR
                                                                                                   (newAexpVar
                                                                                                    ("some-of"))),
                                                                                                  newAexpList
                                                                                                  (NULL,
                                                                                                   newAexp
                                                                                                   (AEXP_TYPE_VAR,
                                                                                                    AEXP_VAL_VAR
                                                                                                    (newAexpVar
                                                                                                     ("except-barrels-1-and-2"))))))))),
                                                                                             newExp
                                                                                             (EXP_TYPE_LET,
                                                                                              EXP_VAL_LET
                                                                                              (newExpLet
                                                                                               (newAexpVar
                                                                                                ("purchase-quantity"),
                                                                                                newExp
                                                                                                (EXP_TYPE_CEXP,
                                                                                                 EXP_VAL_CEXP
                                                                                                 (newCexp
                                                                                                  (CEXP_TYPE_APPLY,
                                                                                                   CEXP_VAL_APPLY
                                                                                                   (newCexpApply
                                                                                                    (newAexp
                                                                                                     (AEXP_TYPE_VAR,
                                                                                                      AEXP_VAL_VAR
                                                                                                      (newAexpVar
                                                                                                       ("sum"))),
                                                                                                     newAexpList
                                                                                                     (NULL,
                                                                                                      newAexp
                                                                                                      (AEXP_TYPE_VAR,
                                                                                                       AEXP_VAL_VAR
                                                                                                       (newAexpVar
                                                                                                        ("purchase"))))))))),
                                                                                                newExp
                                                                                                (EXP_TYPE_LET,
                                                                                                 EXP_VAL_LET
                                                                                                 (newExpLet
                                                                                                  (newAexpVar
                                                                                                   ("f"),
                                                                                                   newExp
                                                                                                   (EXP_TYPE_AEXP,
                                                                                                    EXP_VAL_AEXP
                                                                                                    (newAexp
                                                                                                     (AEXP_TYPE_UNARY,
                                                                                                      AEXP_VAL_UNARY
                                                                                                      (newAexpUnaryApp
                                                                                                       (AEXP_UNARY_PRINT,
                                                                                                        newAexp
                                                                                                        (AEXP_TYPE_LIST,
                                                                                                         AEXP_VAL_LIST
                                                                                                         (newAexpList
                                                                                                          (newAexpList
                                                                                                           (newAexpList
                                                                                                            (NULL,
                                                                                                             newAexp
                                                                                                             (AEXP_TYPE_VAR,
                                                                                                              AEXP_VAL_VAR
                                                                                                              (newAexpVar
                                                                                                               ("purchase-quantity")))),
                                                                                                            newAexp
                                                                                                            (AEXP_TYPE_VAR,
                                                                                                             AEXP_VAL_VAR
                                                                                                             (newAexpVar
                                                                                                              ("barrel-2")))),
                                                                                                           newAexp
                                                                                                           (AEXP_TYPE_VAR,
                                                                                                            AEXP_VAL_VAR
                                                                                                            (newAexpVar
                                                                                                             ("barrel-1"))))))))))),
                                                                                                   newExp
                                                                                                   (EXP_TYPE_LET,
                                                                                                    EXP_VAL_LET
                                                                                                    (newExpLet
                                                                                                     (newAexpVar
                                                                                                      ("f"),
                                                                                                      newExp
                                                                                                      (EXP_TYPE_CEXP,
                                                                                                       EXP_VAL_CEXP
                                                                                                       (newCexp
                                                                                                        (CEXP_TYPE_APPLY,
                                                                                                         CEXP_VAL_APPLY
                                                                                                         (newCexpApply
                                                                                                          (newAexp
                                                                                                           (AEXP_TYPE_VAR,
                                                                                                            AEXP_VAL_VAR
                                                                                                            (newAexpVar
                                                                                                             ("require"))),
                                                                                                           newAexpList
                                                                                                           (NULL,
                                                                                                            newAexp
                                                                                                            (AEXP_TYPE_PRIM,
                                                                                                             AEXP_VAL_PRIM
                                                                                                             (newAexpPrimApp
                                                                                                              (AEXP_PRIM_EQ,
                                                                                                               newAexp
                                                                                                               (AEXP_TYPE_PRIM,
                                                                                                                AEXP_VAL_PRIM
                                                                                                                (newAexpPrimApp
                                                                                                                 (AEXP_PRIM_MUL,
                                                                                                                  newAexp
                                                                                                                  (AEXP_TYPE_INT,
                                                                                                                   AEXP_VAL_INT
                                                                                                                   (2)),
                                                                                                                  newAexp
                                                                                                                  (AEXP_TYPE_PRIM,
                                                                                                                   AEXP_VAL_PRIM
                                                                                                                   (newAexpPrimApp
                                                                                                                    (AEXP_PRIM_ADD,
                                                                                                                     newAexp
                                                                                                                     (AEXP_TYPE_VAR,
                                                                                                                      AEXP_VAL_VAR
                                                                                                                      (newAexpVar
                                                                                                                       ("barrel-1"))),
                                                                                                                     newAexp
                                                                                                                     (AEXP_TYPE_VAR,
                                                                                                                      AEXP_VAL_VAR
                                                                                                                      (newAexpVar
                                                                                                                       ("barrel-2"))))))))),
                                                                                                               newAexp
                                                                                                               (AEXP_TYPE_VAR,
                                                                                                                AEXP_VAL_VAR
                                                                                                                (newAexpVar
                                                                                                                 ("purchase-quantity")))))))))))),
                                                                                                      newExp
                                                                                                      (EXP_TYPE_AEXP,
                                                                                                       EXP_VAL_AEXP
                                                                                                       (newAexp
                                                                                                        (AEXP_TYPE_VAR,
                                                                                                         AEXP_VAL_VAR
                                                                                                         (newAexpVar
                                                                                                          ("beer")))))))))))))))))))))))))))))))))))))))))),
                                              newExp(EXP_TYPE_CEXP,
                                                     EXP_VAL_CEXP(newCexp
                                                                  (CEXP_TYPE_APPLY,
                                                                   CEXP_VAL_APPLY
                                                                   (newCexpApply
                                                                    (newAexp
                                                                     (AEXP_TYPE_VAR,
                                                                      AEXP_VAL_VAR
                                                                      (newAexpVar
                                                                       ("barrels-of-fun"))),
                                                                     newAexpList
                                                                     (NULL,
                                                                      newAexp
                                                                      (AEXP_TYPE_INT,
                                                                       AEXP_VAL_INT
                                                                       (0)))))))))))));
}

Exp *
makeTestExpList() {
  /* list.scm */
  return
    newExp(EXP_TYPE_AEXP,
           EXP_VAL_AEXP(newAexp
                        (AEXP_TYPE_LIST,
                         AEXP_VAL_LIST(newAexpList
                                       (newAexpList
                                        (newAexpList
                                         (NULL,
                                          newAexp(AEXP_TYPE_INT,
                                                  AEXP_VAL_INT(3))),
                                         newAexp(AEXP_TYPE_INT,
                                                 AEXP_VAL_INT(2))),
                                        newAexp(AEXP_TYPE_INT,
                                                AEXP_VAL_INT(1)))))));
}

Exp *makeTestExpClosure()
{
	/* closure.scm */
	return
	    newExp(EXP_TYPE_LET,
		   EXP_VAL_LET(newExpLet
			       (newAexpVar("test"),
				newExp(EXP_TYPE_AEXP,
				       EXP_VAL_AEXP(newAexp
						    (AEXP_TYPE_LAM,
						     AEXP_VAL_LAM(newAexpLam
								  (newAexpVarList
								   (NULL,
								    newAexpVar
								    ("x")),
								   newExp
								   (EXP_TYPE_AEXP,
								    EXP_VAL_AEXP
								    (newAexp
								     (AEXP_TYPE_LAM,
								      AEXP_VAL_LAM
								      (newAexpLam
								       (newAexpVarList
									(NULL,
									 newAexpVar
									 ("y")),
									newExp
									(EXP_TYPE_AEXP,
									 EXP_VAL_AEXP
									 (newAexp
									  (AEXP_TYPE_PRIM,
									   AEXP_VAL_PRIM
									   (newAexpPrimApp
									    (AEXP_PRIM_ADD,
									     newAexp
									     (AEXP_TYPE_VAR,
									      AEXP_VAL_VAR
									      (newAexpVar
									       ("x"))),
									     newAexp
									     (AEXP_TYPE_VAR,
									      AEXP_VAL_VAR
									      (newAexpVar
									       ("y")))))))))))))))))),
				newExp(EXP_TYPE_LET,
				       EXP_VAL_LET(newExpLet
						   (newAexpVar("add2"),
						    newExp(EXP_TYPE_CEXP,
							   EXP_VAL_CEXP(newCexp
									(CEXP_TYPE_APPLY,
									 CEXP_VAL_APPLY
									 (newCexpApply
									  (newAexp
									   (AEXP_TYPE_VAR,
									    AEXP_VAL_VAR
									    (newAexpVar
									     ("test"))),
									   newAexpList
									   (NULL,
									    newAexp
									    (AEXP_TYPE_INT,
									     AEXP_VAL_INT
									     (2)))))))),
						    newExp(EXP_TYPE_CEXP,
							   EXP_VAL_CEXP(newCexp
									(CEXP_TYPE_APPLY,
									 CEXP_VAL_APPLY
									 (newCexpApply
									  (newAexp
									   (AEXP_TYPE_VAR,
									    AEXP_VAL_VAR
									    (newAexpVar
									     ("add2"))),
									   newAexpList
									   (NULL,
									    newAexp
									    (AEXP_TYPE_INT,
									     AEXP_VAL_INT
									     (3))))))))))))));
}

#ifdef DEBUG_STEP
#define DUMP_BYTECODE(bc) dumpByteCode(bc)
#else
#define DUMP_BYTECODE(bc) do {} while(0)
#endif

#define RUN_EXP(build) \
do { \
    printf("\n" #build "\n\n"); \
    disableGC(); \
    exp = build; \
    save = PROTECT(exp); \
    exp = desugarExp(exp); \
    analizeExp(exp, NULL); \
    printExp(exp); \
    printf("\n"); \
    initByteCodeArray(&byteCodes); \
    writeExp(exp, &byteCodes); \
    writeEnd(&byteCodes); \
    DUMP_BYTECODE(&byteCodes); \
    UNPROTECT(save); \
    enableGC(); \
    printContainedValue(run(byteCodes), 1); \
    printf("\n"); \
} while(0)

int main(int argc, char *argv[]) {

#ifdef TEST_STACK
    testStack();
    exit(0);
#endif
    ByteCodeArray byteCodes;
    int save;
    Exp *exp;

    int depth = 4;
    if (argc == 2) depth = atoi(argv[1]);

    // RUN_EXP(makeTestExpFib(depth));
    // RUN_EXP(makeTestExpCons());
    // RUN_EXP(makeTestExpXor());
    // RUN_EXP(makeTestExpNot());
    // RUN_EXP(makeTestExpBool());
    // RUN_EXP(makeTestExpAmb());
    // RUN_EXP(makeTestExpCallCC());
    // RUN_EXP(makeTestExpCallCC2());
    // RUN_EXP(makeTestExpClosure());
    // RUN_EXP(makeTestExpList());
    // RUN_EXP(makeTestExpLiars());
    // RUN_EXP(makeTestExpOneOf());
    // RUN_EXP(makeTestExpExclude());
    RUN_EXP(makeTestExpBeer());
}

#else /* testing parser */

// extern int yydebug;

extern AstNest *result;

int main(int argc, char *argv[]) {
    disableGC();
    // yydebug = 1;
    yyparse();
    printAstNest(result);
    printf("\n");
}

#endif

#else

int main(int argc, char *argv[]) {
}

#endif
